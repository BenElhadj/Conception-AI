import"../chunks/DsnmJJEf.js";import{i as Q}from"../chunks/18xEWTec.js";import{w as Pe,e as J,s as H,o as Me,g as q}from"../chunks/D-bie2bq.js";import{h as G,D as Oe,C as Te,i as A,a2 as Ne,F as Ke,H as Re,G as he,I as me,J as se,S as W,am as De,aO as Ge,M as ve,P as Ue,O as j,aK as be,aD as He,K as Le,W as B,aj as _e,al as ze,Q as Ae,R as Be,a$ as Je,b0 as le,au as we,b1 as Ve,b2 as Ye,aA as qe,b3 as je,aJ as Fe,b4 as We,a0 as Xe,b5 as Qe,af as Ze,e as Ie,ac as et,b6 as tt,x as Z,t as T,v as L,p as k,y as ee,z as $,A as S,B as w,ah as at,b7 as rt,b8 as nt,m as $e,o as ne,X as C,j as ye,b9 as ot,av as ge}from"../chunks/Cbqb5KLJ.js";import{p as R,i as V,s as te,a as ae}from"../chunks/BQ1Wj4N3.js";import{r as st}from"../chunks/cN3y8ZJr.js";function lt(e,a){return a}function it(e,a,t){for(var s=e.items,i=[],o=a.length,c=0;c<o;c++)je(a[c].e,i,!0);var l=o>0&&i.length===0&&t!==null;if(l){var d=t.parentNode;Fe(d),d.append(t),s.clear(),D(e,a[0].prev,a[o-1].next)}We(i,()=>{for(var u=0;u<o;u++){var f=a[u];l||(s.delete(f.k),D(e,f.prev,f.next)),we(f.e,!l)}})}function ct(e,a,t,s,i,o=null){var c=e,l={flags:a,items:new Map,first:null};G&&Oe();var d=null,u=!1,f=new Map,b=Ne(()=>{var r=t();return He(r)?r:r==null?[]:be(r)}),n,p;function v(){ut(p,n,l,f,c,i,a,s,t),o!==null&&(n.length===0?d?Ae(d):d=ve(()=>o(c)):d!==null&&Be(d,()=>{d=null}))}Te(()=>{p??=Xe,n=A(b);var r=n.length;if(u&&r===0)return;u=r===0;let y=!1;if(G){var M=Ke(c)===Re;M!==(r===0)&&(c=he(),me(c),se(!1),y=!0)}if(G){for(var x=null,h,_=0;_<r;_++){if(W.nodeType===De&&W.data===Ge){c=W,y=!0,se(!1);break}var I=n[_],O=s(I,_);h=de(W,l,x,null,I,O,_,i,a,t),l.items.set(O,h),x=h}r>0&&me(he())}if(G)r===0&&o&&(d=ve(()=>o(c)));else if(Ue()){var E=new Set,N=j;for(_=0;_<r;_+=1){I=n[_],O=s(I,_);var P=l.items.get(O)??f.get(O);P?Se(P,I,_):(h=de(null,l,null,null,I,O,_,i,a,t,!0),f.set(O,h)),E.add(O)}for(const[Y,z]of l.items)E.has(Y)||N.skipped_effects.add(z.e);N.add_callback(v)}else v();y&&se(!0),A(b)}),G&&(c=W)}function ut(e,a,t,s,i,o,c,l,d){var u=a.length,f=t.items,b=t.first,n=b,p,v=null,r=[],y=[],M,x,h,_;for(_=0;_<u;_+=1){if(M=a[_],x=l(M,_),h=f.get(x),h===void 0){var I=s.get(x);if(I!==void 0){s.delete(x),f.set(x,I);var O=v?v.next:n;D(t,v,I),D(t,I,O),ie(I,O,i),v=I}else{var E=n?n.e.nodes_start:i;v=de(E,t,v,v===null?t.first:v.next,M,x,_,o,c,d)}f.set(x,v),r=[],y=[],n=v.next;continue}if(Se(h,M,_),(h.e.f&le)!==0&&Ae(h.e),h!==n){if(p!==void 0&&p.has(h)){if(r.length<y.length){var N=y[0],P;v=N.prev;var Y=r[0],z=r[r.length-1];for(P=0;P<r.length;P+=1)ie(r[P],N,i);for(P=0;P<y.length;P+=1)p.delete(y[P]);D(t,Y.prev,z.next),D(t,v,Y),D(t,z,N),n=N,v=z,_-=1,r=[],y=[]}else p.delete(h),ie(h,n,i),D(t,h.prev,h.next),D(t,h,v===null?t.first:v.next),D(t,v,h),v=h;continue}for(r=[],y=[];n!==null&&n.k!==x;)(n.e.f&le)===0&&(p??=new Set).add(n),y.push(n),n=n.next;if(n===null)continue;h=n}r.push(h),v=h,n=h.next}if(n!==null||p!==void 0){for(var m=p===void 0?[]:be(p);n!==null;)(n.e.f&le)===0&&m.push(n),n=n.next;var g=m.length;if(g>0){var K=null;it(t,m,K)}}e.first=t.first&&t.first.e,e.last=v&&v.e;for(var U of s.values())we(U.e);s.clear()}function Se(e,a,t,s){ze(e.v,a),e.i=t}function de(e,a,t,s,i,o,c,l,d,u,f){var b=(d&Ve)!==0,n=(d&Ye)===0,p=b?n?B(i,!1,!1):_e(i):i,v=(d&Je)===0?c:_e(c),r={i:v,v:p,k:o,a:null,e:null,prev:t,next:s};try{if(e===null){var y=document.createDocumentFragment();y.append(e=Le())}return r.e=ve(()=>l(e,p,v,u),G),r.e.prev=t&&t.e,r.e.next=s&&s.e,t===null?f||(a.first=r):(t.next=r,t.e.next=r.e),s!==null&&(s.prev=r,s.e.prev=r.e),r}finally{}}function ie(e,a,t){for(var s=e.next?e.next.e.nodes_start:t,i=a?a.e.nodes_start:t,o=e.e.nodes_start;o!==null&&o!==s;){var c=qe(o);i.before(o),o=c}}function D(e,a,t){a===null?e.first=t:(a.next=t,a.e.next=t&&t.e),t!==null&&(t.prev=a,t.e.prev=a&&a.e)}function vt(e,a,t){var s=e==null?"":""+e;return s===""?null:s}function ke(e,a,t,s,i,o){var c=e.__className;if(G||c!==t||c===void 0){var l=vt(t);(!G||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):e.className=l),e.__className=t}return o}function xe(e,a,t=a){var s=new WeakSet;Qe(e,"input",async i=>{var o=i?e.defaultValue:e.value;if(o=ce(e)?ue(o):o,t(o),j!==null&&s.add(j),await Ze(),o!==(o=a())){var c=e.selectionStart,l=e.selectionEnd,d=e.value.length;if(e.value=o??"",l!==null){var u=e.value.length;c===l&&l===d&&u>d?(e.selectionStart=u,e.selectionEnd=u):(e.selectionStart=c,e.selectionEnd=Math.min(l,u))}}}),(G&&e.defaultValue!==e.value||Ie(a)==null&&e.value)&&(t(ce(e)?ue(e.value):e.value),j!==null&&s.add(j)),et(()=>{var i=a();if(e===document.activeElement){var o=tt??j;if(s.has(o))return}ce(e)&&i===ue(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function ce(e){var a=e.type;return a==="number"||a==="range"}function ue(e){return e===""?null:+e}const dt="https://api.openai.com/v1/chat/completions";async function ft(e){const a=localStorage.getItem("openai_api_key");if(!a)throw new Error("Clé API OpenAI manquante. Veuillez la fournir dans les paramètres.");const t=await fetch(dt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Tu es un assistant expert qui génère un composant Svelte           utilisable directement dans une div,          toujours dans un fichier .svelte valide.          Retourne exactement un seul bloc .svelte avec :          - une balise <script> (optionnelle mais propre)          - une balise <style> (optionnelle mais propre)          - un bloc HTML racine <div> ou <main>.          N'inclus jamais <html>, <head>, <body>,          ni doctype, ni meta, ni title, ni markdown.          Pas d'import ni export par défaut."},...e],temperature:.7})});if(!t.ok){const o=await t.json();throw new Error(`Erreur API: ${o.error?.message||t.statusText}`)}return((await t.json()).choices?.[0]?.message?.content||"Erreur : aucune réponse valide.").replace(/```svelte|```/g,"").trim()}function oe(e,a){const t=(()=>{try{const i=localStorage.getItem(e);return i?JSON.parse(i):a}catch{return a}})(),s=Pe(t);return s.subscribe(i=>{try{localStorage.setItem(e,JSON.stringify(i))}catch{}}),s}const X=oe("chat_history",[]),re=oe("history_stack",[]),F=oe("generated_code",""),fe=oe("layout_pref","horizontal");var pt=T('<span style="font-size: 1.3rem;">lll</span>'),ht=T('<div class="header"><button class="api-btn"> </button> <h1>Conception AI – Svelte Page Generator</h1> <button><!></button></div>');function mt(e,a){Z(a,!1);const t=()=>ae(fe,"$layout",s),[s,i]=te();let o=R(a,"apiKey",8,""),c=R(a,"onApiModalOpen",8);function l(){fe.update(r=>r==="horizontal"?"vertical":"horizontal")}Q();var d=ht(),u=$(d),f=$(u,!0);S(u);var b=w(u,4),n=$(b);{var p=r=>{var y=at("≡");k(r,y)},v=r=>{var y=pt();k(r,y)};V(n,r=>{t()==="horizontal"?r(p):r(v,!1)})}S(b),S(d),L(()=>{H(f,o()?"Change API Key":"Add API Key"),ke(b,1,`layout-btn ${t()??""}`)}),J("click",u,function(...r){c()?.apply(this,r)}),J("click",b,l),k(e,d),ee(),i()}var _t=T('<p class="modal-error"> </p>'),yt=T('<div class="modal-backdrop"><div class="modal"><h2> </h2> <input type="text" placeholder="Enter your OpenAI API key (sk-...)"/> <!> <div class="modal-actions"><button>Save</button> <button>Cancel</button></div></div></div>');function gt(e,a){Z(a,!1);let t=R(a,"show",8,!1),s=R(a,"apiKey",8,""),i=R(a,"error",8,""),o=R(a,"onSave",8),c=R(a,"onCancel",8),l=B("");function d(){o()(A(l).trim())}rt(()=>(ye(t()),ye(s())),()=>{t()&&C(l,s())}),nt(),Q();var u=$e(),f=ne(u);{var b=n=>{var p=yt(),v=$(p),r=$(v),y=$(r,!0);S(r);var M=w(r,2);st(M);var x=w(M,2);{var h=E=>{var N=_t(),P=$(N,!0);S(N),L(()=>H(P,i())),k(E,N)};V(x,E=>{i()&&E(h)})}var _=w(x,2),I=$(_),O=w(I,2);S(_),S(v),S(p),L(()=>H(y,s()?"Change API Key":"Add API Key")),xe(M,()=>A(l),E=>C(l,E)),J("click",I,d),J("click",O,function(...E){c()?.apply(this,E)}),k(n,p)};V(f,n=>{t()&&n(b)})}k(e,u),ee()}var bt=T('<div class="controls"><button> </button> <button>Undo</button></div>');function At(e,a){Z(a,!1);const t=()=>ae(re,"$historyStack",s),[s,i]=te();let o=R(a,"loading",8,!1),c=R(a,"onGenerate",8),l=R(a,"onUndo",8);Q();var d=bt(),u=$(d),f=$(u,!0);S(u);var b=w(u,2);S(d),L(()=>{u.disabled=o(),H(f,o()?"Generation...":"Generate new"),b.disabled=(t(),Ie(()=>t().length===0))}),J("click",u,function(...n){c()?.apply(this,n)}),J("click",b,function(...n){l()?.apply(this,n)}),k(e,d),ee(),i()}var wt=T(`<section class="panel"><h2>Prompt</h2> <textarea placeholder="Describe or refine the page... (e.g., 'Add a red button')"></textarea></section>`);function It(e,a){let t=R(a,"prompt",12,"");var s=wt(),i=w($(s),2);ot(i),S(s),xe(i,t),k(e,s)}var $t=T(`
        <code> </code>
      `,1),St=T("<button>Download .svelte</button>"),kt=T(`<section class="panel"><h2>Generated Code</h2> <pre>
      <!>
    </pre> <!></section>`);function xt(e,a){const t=()=>ae(F,"$generatedCode",s),[s,i]=te();let o=R(a,"onDownload",8);var c=kt(),l=w($(c),2),d=w($(l));{var u=n=>{var p=$t(),v=w(ne(p)),r=$(v,!0);S(v),ge(),L(()=>H(r,t())),k(n,p)};V(d,n=>{t()&&n(u)})}ge(),S(l);var f=w(l,2);{var b=n=>{var p=St();J("click",p,function(...v){o()?.apply(this,v)}),k(n,p)};V(f,n=>{t()&&n(b)})}S(c),k(e,c),i()}var Et=T('<section class="panel"><h2>Preview</h2> <iframe id="preview-iframe" class="preview" sandbox="allow-scripts" referrerpolicy="no-referrer" title="Preview Generated Code"></iframe></section>');function Ct(e){var a=Et();k(e,a)}var Pt=T('<p style="text-align:center; color:#777;">No messages yet</p>'),Mt=T("<div><strong> </strong> </div>"),Ot=T('<section class="panel"><h2>Conversation History</h2> <!></section>');function Tt(e,a){Z(a,!1);const t=()=>ae(X,"$conversation",s),[s,i]=te();Q();var o=Ot(),c=w($(o),2);{var l=u=>{var f=Pt();k(u,f)},d=u=>{var f=$e(),b=ne(f);ct(b,1,t,lt,(n,p)=>{var v=Mt(),r=$(v),y=$(r);S(r);var M=w(r);S(v),L(()=>{H(y,`${A(p).role??""}:`),H(M,` ${A(p).content??""}`)}),k(n,v)}),k(u,f)};V(c,u=>{t().length===0?u(l):u(d,!1)})}S(o),k(e,o),ee(),i()}var Nt=T('<p class="error"> </p>'),Kt=T("<!> <!> <!> <!> <div><!> <!> <!></div> <!>",1);function zt(e,a){Z(a,!1);const t=()=>ae(fe,"$layout",s),[s,i]=te();let o=B(""),c=B(""),l=B(""),d=B(!1),u=B(!1);Me(()=>{browser&&(console.log("App mounted successfully"),console.log("Current path:",window.location.pathname),console.log("Base URL:","./")),C(o,localStorage.getItem("openai_api_key")||"");const m=q(F);m&&r(m)});function f(){C(u,!0)}function b(m){m&&(C(o,m),localStorage.setItem("openai_api_key",A(o)),C(u,!1),C(l,""),alert("API Key saved."))}function n(){C(u,!1)}async function p(){if(!A(o)){C(l,"Please set your OpenAI API key first You can find your API key at https://platform.openai.com/account/api-keys."),f();return}if(A(c)){C(d,!0),C(l,"");try{const m=[...q(X),{role:"user",content:A(c)}],g=await ft(m);if(g.includes("Erreur"))throw new Error(g);re.update(K=>[...K,{code:q(F),chat:q(X)}]),F.set(g),X.update(K=>[...K,{role:"user",content:A(c)},{role:"assistant",content:g}]),r(g),C(c,"")}catch(m){C(l,m.message),A(l).includes("Incorrect API key provided")&&(C(l,"Erreur API: Incorrect API key provided You can find your API key at https://platform.openai.com/account/api-keys."),f())}finally{C(d,!1)}}}function v(){const m=q(re);if(m.length===0)return;const g=m[m.length-1];re.set(m.slice(0,-1)),F.set(g.code||""),X.set(g.chat||[]),r(g.code||"")}function r(m){try{const g=m.replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<\/?(html|head|body)[^>]*>/gi,""),K=g.match(/<style[^>]*>([\s\S]*?)<\/style>/i),U=g.match(/<script[^>]*>([\s\S]*?)<\/script>/i);let Ee=g.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"");const Ce=`
        <html>
          <head>
            ${K?`<style>${K[1]}</style>`:""}
          </head>
          <body>
            ${Ee}
            ${U?`<script>${U[1]}<\/script>`:""}
          </body>
        </html>
      `,pe=document.getElementById("preview-iframe");pe&&(pe.srcdoc=Ce)}catch(g){C(l,`Render error: ${g.message}`)}}function y(){const m=q(F);if(!m)return;const g=new Blob([m],{type:"text/plain"}),K=URL.createObjectURL(g),U=document.createElement("a");U.href=K,U.download="GeneratedPage.svelte",U.click(),URL.revokeObjectURL(K)}Q();var M=Kt(),x=ne(M);mt(x,{get apiKey(){return A(o)},onApiModalOpen:f});var h=w(x,2);gt(h,{get show(){return A(u)},get apiKey(){return A(o)},get error(){return A(l)},onSave:b,onCancel:n});var _=w(h,2);At(_,{get loading(){return A(d)},onGenerate:p,onUndo:v});var I=w(_,2);{var O=m=>{var g=Nt(),K=$(g,!0);S(g),L(()=>H(K,A(l))),k(m,g)};V(I,m=>{A(l)&&m(O)})}var E=w(I,2),N=$(E);It(N,{get prompt(){return A(c)},set prompt(m){C(c,m)},$$legacy:!0});var P=w(N,2);xt(P,{onDownload:y});var Y=w(P,2);Ct(Y),S(E);var z=w(E,2);Tt(z,{}),L(()=>ke(E,1,`container ${t()??""}`)),k(e,M),ee(),i()}export{zt as component};
