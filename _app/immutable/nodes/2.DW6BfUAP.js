import"../chunks/DsnmJJEf.js";import{i as j}from"../chunks/BUNOAlaI.js";import{w as Me,e as B,s as H,o as Te,g as J}from"../chunks/BLeTYQ1A.js";import{y as R,z as Ne,x as Oe,j as A,Y as Ke,A as Le,H as Re,B as he,C as _e,D as se,M as Q,ad as De,ah as Ge,G as ve,J as He,I as F,al as Ae,a9 as Ue,F as ze,P as Y,aG as me,aH as Ye,K as we,L as Be,aI as Ve,aJ as le,aK as Ie,aL as qe,aM as Je,af as Fe,aN as We,ak as Qe,aO as Xe,W as je,aP as Ze,aQ as ea,aR as aa,aS as ta,aT as ra,aA as na,g as ke,aC as oa,aU as sa,p as Z,b as N,t as U,a as E,o as ee,q as k,v as S,w,aF as la,aV as ia,aW as ca,c as Se,f as ne,Q as x,k as ye,aX as ua,aY as ge}from"../chunks/DylrdsE-.js";import{p as L,i as V,s as ae,a as te}from"../chunks/BuJTuhpH.js";function va(e,a){return a}function da(e,a,t){for(var o=e.items,r=[],l=a.length,c=0;c<l;c++)We(a[c].e,r,!0);var i=l>0&&r.length===0&&t!==null;if(i){var d=t.parentNode;Qe(d),d.append(t),o.clear(),D(e,a[0].prev,a[l-1].next)}Xe(r,()=>{for(var v=0;v<l;v++){var f=a[v];i||(o.delete(f.k),D(e,f.prev,f.next)),Ie(f.e,!i)}})}function fa(e,a,t,o,r,l=null){var c=e,i={flags:a,items:new Map,first:null};R&&Ne();var d=null,v=!1,f=new Map,b=Ke(()=>{var n=t();return Ue(n)?n:n==null?[]:Ae(n)}),s,p;function u(){pa(p,s,i,f,c,r,a,o,t),l!==null&&(s.length===0?d?we(d):d=ve(()=>l(c)):d!==null&&Be(d,()=>{d=null}))}Oe(()=>{p??=je,s=A(b);var n=s.length;if(v&&n===0)return;v=n===0;let y=!1;if(R){var M=Le(c)===Re;M!==(n===0)&&(c=he(),_e(c),se(!1),y=!0)}if(R){for(var C=null,h,m=0;m<n;m++){if(Q.nodeType===De&&Q.data===Ge){c=Q,y=!0,se(!1);break}var I=s[m],T=o(I,m);h=de(Q,i,C,null,I,T,m,r,a,t),i.items.set(T,h),C=h}n>0&&_e(he())}if(R)n===0&&l&&(d=ve(()=>l(c)));else if(He()){var $=new Set,O=F;for(m=0;m<n;m+=1){I=s[m],T=o(I,m);var P=i.items.get(T)??f.get(T);P?Ee(P,I,m):(h=de(null,i,null,null,I,T,m,r,a,t,!0),f.set(T,h)),$.add(T)}for(const[q,z]of i.items)$.has(q)||O.skipped_effects.add(z.e);O.add_callback(u)}else u();y&&se(!0),A(b)}),R&&(c=Q)}function pa(e,a,t,o,r,l,c,i,d){var v=a.length,f=t.items,b=t.first,s=b,p,u=null,n=[],y=[],M,C,h,m;for(m=0;m<v;m+=1){if(M=a[m],C=i(M,m),h=f.get(C),h===void 0){var I=o.get(C);if(I!==void 0){o.delete(C),f.set(C,I);var T=u?u.next:s;D(t,u,I),D(t,I,T),ie(I,T,r),u=I}else{var $=s?s.e.nodes_start:r;u=de($,t,u,u===null?t.first:u.next,M,C,m,l,c,d)}f.set(C,u),n=[],y=[],s=u.next;continue}if(Ee(h,M,m),(h.e.f&le)!==0&&we(h.e),h!==s){if(p!==void 0&&p.has(h)){if(n.length<y.length){var O=y[0],P;u=O.prev;var q=n[0],z=n[n.length-1];for(P=0;P<n.length;P+=1)ie(n[P],O,r);for(P=0;P<y.length;P+=1)p.delete(y[P]);D(t,q.prev,z.next),D(t,u,q),D(t,z,O),s=O,u=z,m-=1,n=[],y=[]}else p.delete(h),ie(h,s,r),D(t,h.prev,h.next),D(t,h,u===null?t.first:u.next),D(t,u,h),u=h;continue}for(n=[],y=[];s!==null&&s.k!==C;)(s.e.f&le)===0&&(p??=new Set).add(s),y.push(s),s=s.next;if(s===null)continue;h=s}n.push(h),u=h,s=h.next}if(s!==null||p!==void 0){for(var _=p===void 0?[]:Ae(p);s!==null;)(s.e.f&le)===0&&_.push(s),s=s.next;var g=_.length;if(g>0){var K=null;da(t,_,K)}}e.first=t.first&&t.first.e,e.last=u&&u.e;for(var G of o.values())Ie(G.e);o.clear()}function Ee(e,a,t,o){Ye(e.v,a),e.i=t}function de(e,a,t,o,r,l,c,i,d,v,f){var b=(d&qe)!==0,s=(d&Je)===0,p=b?s?Y(r,!1,!1):me(r):r,u=(d&Ve)===0?c:me(c),n={i:u,v:p,k:l,a:null,e:null,prev:t,next:o};try{if(e===null){var y=document.createDocumentFragment();y.append(e=ze())}return n.e=ve(()=>i(e,p,u,v),R),n.e.prev=t&&t.e,n.e.next=o&&o.e,t===null?f||(a.first=n):(t.next=n,t.e.next=n.e),o!==null&&(o.prev=n,o.e.prev=n.e),n}finally{}}function ie(e,a,t){for(var o=e.next?e.next.e.nodes_start:t,r=a?a.e.nodes_start:t,l=e.e.nodes_start;l!==null&&l!==o;){var c=Fe(l);r.before(l),l=c}}function D(e,a,t){a===null?e.first=t:(a.next=t,a.e.next=t&&t.e),t!==null&&(t.prev=a,t.e.prev=a&&a.e)}function ha(e,a,t){var o=e==null?"":""+e;return o===""?null:o}function Ce(e,a,t,o,r,l){var c=e.__className;if(R||c!==t||c===void 0){var i=ha(t);(!R||i!==e.getAttribute("class"))&&(i==null?e.removeAttribute("class"):e.className=i),e.__className=t}return l}const _a=Symbol("is custom element"),ma=Symbol("is html");function ya(e){if(R){var a=!1,t=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var o=e.value;be(e,"value",null),e.value=o}if(e.hasAttribute("checked")){var r=e.checked;be(e,"checked",null),e.checked=r}}};e.__on_r=t,Ze(t),ea()}}function be(e,a,t,o){var r=ga(e);R&&(r[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||r[a]!==(r[a]=t)&&(a==="loading"&&(e[aa]=t),e.removeAttribute(a))}function ga(e){return e.__attributes??={[_a]:e.nodeName.includes("-"),[ma]:e.namespaceURI===ta}}function $e(e,a,t=a){var o=new WeakSet;ra(e,"input",async r=>{var l=r?e.defaultValue:e.value;if(l=ce(e)?ue(l):l,t(l),F!==null&&o.add(F),await na(),l!==(l=a())){var c=e.selectionStart,i=e.selectionEnd;e.value=l??"",i!==null&&(e.selectionStart=c,e.selectionEnd=Math.min(i,e.value.length))}}),(R&&e.defaultValue!==e.value||ke(a)==null&&e.value)&&(t(ce(e)?ue(e.value):e.value),F!==null&&o.add(F)),oa(()=>{var r=a();if(e===document.activeElement){var l=sa??F;if(o.has(l))return}ce(e)&&r===ue(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function ce(e){var a=e.type;return a==="number"||a==="range"}function ue(e){return e===""?null:+e}const ba="https://api.openai.com/v1/chat/completions";async function Aa(e){const a=localStorage.getItem("openai_api_key");if(!a)throw new Error("Clé API OpenAI manquante. Veuillez la fournir dans les paramètres.");const t=await fetch(ba,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Tu es un assistant expert qui génère un composant Svelte           utilisable directement dans une div,          toujours dans un fichier .svelte valide.          Retourne exactement un seul bloc .svelte avec :          - une balise <script> (optionnelle mais propre)          - une balise <style> (optionnelle mais propre)          - un bloc HTML racine <div> ou <main>.          N'inclus jamais <html>, <head>, <body>,          ni doctype, ni meta, ni title, ni markdown.          Pas d'import ni export par défaut."},...e],temperature:.7})});if(!t.ok){const l=await t.json();throw new Error(`Erreur API: ${l.error?.message||t.statusText}`)}return((await t.json()).choices?.[0]?.message?.content||"Erreur : aucune réponse valide.").replace(/```svelte|```/g,"").trim()}function oe(e,a){const t=(()=>{try{const r=localStorage.getItem(e);return r?JSON.parse(r):a}catch{return a}})(),o=Me(t);return o.subscribe(r=>{try{localStorage.setItem(e,JSON.stringify(r))}catch{}}),o}const X=oe("chat_history",[]),re=oe("history_stack",[]),W=oe("generated_code",""),fe=oe("layout_pref","horizontal");var wa=N('<span style="font-size: 1.3rem;">lll</span>'),Ia=N('<div class="header"><button class="api-btn"> </button> <h1>Conception AI – Svelte Page Generator</h1> <button><!></button></div>');function ka(e,a){Z(a,!1);const[t,o]=ae(),r=()=>te(fe,"$layout",t);let l=L(a,"apiKey",8,""),c=L(a,"onApiModalOpen",8);function i(){fe.update(n=>n==="horizontal"?"vertical":"horizontal")}j();var d=Ia(),v=k(d),f=k(v,!0);S(v);var b=w(v,4),s=k(b);{var p=n=>{var y=la("≡");E(n,y)},u=n=>{var y=wa();E(n,y)};V(s,n=>{r()==="horizontal"?n(p):n(u,!1)})}S(b),S(d),U(()=>{H(f,l()?"Change API Key":"Add API Key"),Ce(b,1,`layout-btn ${r()??""}`)}),B("click",v,function(...n){c()?.apply(this,n)}),B("click",b,i),E(e,d),ee(),o()}var Sa=N('<p class="modal-error"> </p>'),Ea=N('<div class="modal-backdrop"><div class="modal"><h2> </h2> <input type="text" placeholder="Enter your OpenAI API key (sk-...)"/> <!> <div class="modal-actions"><button>Save</button> <button>Cancel</button></div></div></div>');function Ca(e,a){Z(a,!1);let t=L(a,"show",8,!1),o=L(a,"apiKey",8,""),r=L(a,"error",8,""),l=L(a,"onSave",8),c=L(a,"onCancel",8),i=Y("");function d(){l()(A(i).trim())}ia(()=>(ye(t()),ye(o())),()=>{t()&&x(i,o())}),ca(),j();var v=Se(),f=ne(v);{var b=s=>{var p=Ea(),u=k(p),n=k(u),y=k(n,!0);S(n);var M=w(n,2);ya(M);var C=w(M,2);{var h=$=>{var O=Sa(),P=k(O,!0);S(O),U(()=>H(P,r())),E($,O)};V(C,$=>{r()&&$(h)})}var m=w(C,2),I=k(m),T=w(I,2);S(m),S(u),S(p),U(()=>H(y,o()?"Change API Key":"Add API Key")),$e(M,()=>A(i),$=>x(i,$)),B("click",I,d),B("click",T,function(...$){c()?.apply(this,$)}),E(s,p)};V(f,s=>{t()&&s(b)})}E(e,v),ee()}var $a=N('<div class="controls"><button> </button> <button>Undo</button></div>');function xa(e,a){Z(a,!1);const[t,o]=ae(),r=()=>te(re,"$historyStack",t);let l=L(a,"loading",8,!1),c=L(a,"onGenerate",8),i=L(a,"onUndo",8);j();var d=$a(),v=k(d),f=k(v,!0);S(v);var b=w(v,2);S(d),U(()=>{v.disabled=l(),H(f,l()?"Generation...":"Generate new"),b.disabled=(r(),ke(()=>r().length===0))}),B("click",v,function(...s){c()?.apply(this,s)}),B("click",b,function(...s){i()?.apply(this,s)}),E(e,d),ee(),o()}var Pa=N(`<section class="panel"><h2>Prompt</h2> <textarea placeholder="Describe or refine the page... (e.g., 'Add a red button')"></textarea></section>`);function Ma(e,a){let t=L(a,"prompt",12,"");var o=Pa(),r=w(k(o),2);ua(r),S(o),$e(r,t),E(e,o)}var Ta=N(`
        <code> </code>
      `,1),Na=N("<button>Download .svelte</button>"),Oa=N(`<section class="panel"><h2>Generated Code</h2> <pre>
      <!>
    </pre> <!></section>`);function Ka(e,a){const[t,o]=ae(),r=()=>te(W,"$generatedCode",t);let l=L(a,"onDownload",8);var c=Oa(),i=w(k(c),2),d=w(k(i));{var v=s=>{var p=Ta(),u=w(ne(p)),n=k(u,!0);S(u),ge(),U(()=>H(n,r())),E(s,p)};V(d,s=>{r()&&s(v)})}ge(),S(i);var f=w(i,2);{var b=s=>{var p=Na();B("click",p,function(...u){l()?.apply(this,u)}),E(s,p)};V(f,s=>{r()&&s(b)})}S(c),E(e,c),o()}var La=N('<section class="panel"><h2>Preview</h2> <iframe id="preview-iframe" class="preview" sandbox="allow-scripts" referrerpolicy="no-referrer" title="Preview Generated Code"></iframe></section>');function Ra(e){var a=La();E(e,a)}var Da=N('<p style="text-align:center; color:#777;">No messages yet</p>'),Ga=N("<div><strong> </strong> </div>"),Ha=N('<section class="panel"><h2>Conversation History</h2> <!></section>');function Ua(e,a){Z(a,!1);const[t,o]=ae(),r=()=>te(X,"$conversation",t);j();var l=Ha(),c=w(k(l),2);{var i=v=>{var f=Da();E(v,f)},d=v=>{var f=Se(),b=ne(f);fa(b,1,r,va,(s,p)=>{var u=Ga(),n=k(u),y=k(n);S(n);var M=w(n);S(u),U(()=>{H(y,`${A(p).role??""}:`),H(M,` ${A(p).content??""}`)}),E(s,u)}),E(v,f)};V(c,v=>{r().length===0?v(i):v(d,!1)})}S(l),E(e,l),ee(),o()}var za=N('<p class="error"> </p>'),Ya=N("<!> <!> <!> <!> <div><!> <!> <!></div> <!>",1);function Wa(e,a){Z(a,!1);const[t,o]=ae(),r=()=>te(fe,"$layout",t);let l=Y(""),c=Y(""),i=Y(""),d=Y(!1),v=Y(!1);Te(()=>{x(l,localStorage.getItem("openai_api_key")||"");const _=J(W);_&&n(_)});function f(){x(v,!0)}function b(_){_&&(x(l,_),localStorage.setItem("openai_api_key",A(l)),x(v,!1),x(i,""),alert("API Key saved."))}function s(){x(v,!1)}async function p(){if(!A(l)){x(i,"Please set your OpenAI API key first You can find your API key at https://platform.openai.com/account/api-keys."),f();return}if(A(c)){x(d,!0),x(i,"");try{const _=[...J(X),{role:"user",content:A(c)}],g=await Aa(_);if(g.includes("Erreur"))throw new Error(g);re.update(K=>[...K,{code:J(W),chat:J(X)}]),W.set(g),X.update(K=>[...K,{role:"user",content:A(c)},{role:"assistant",content:g}]),n(g),x(c,"")}catch(_){x(i,_.message),A(i).includes("Incorrect API key provided")&&(x(i,"Erreur API: Incorrect API key provided You can find your API key at https://platform.openai.com/account/api-keys."),f())}finally{x(d,!1)}}}function u(){const _=J(re);if(_.length===0)return;const g=_[_.length-1];re.set(_.slice(0,-1)),W.set(g.code||""),X.set(g.chat||[]),n(g.code||"")}function n(_){try{const g=_.replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<\/?(html|head|body)[^>]*>/gi,""),K=g.match(/<style[^>]*>([\s\S]*?)<\/style>/i),G=g.match(/<script[^>]*>([\s\S]*?)<\/script>/i);let xe=g.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"");const Pe=`
        <html>
          <head>
            ${K?`<style>${K[1]}</style>`:""}
          </head>
          <body>
            ${xe}
            ${G?`<script>${G[1]}<\/script>`:""}
          </body>
        </html>
      `,pe=document.getElementById("preview-iframe");pe&&(pe.srcdoc=Pe)}catch(g){x(i,`Render error: ${g.message}`)}}function y(){const _=J(W);if(!_)return;const g=new Blob([_],{type:"text/plain"}),K=URL.createObjectURL(g),G=document.createElement("a");G.href=K,G.download="GeneratedPage.svelte",G.click(),URL.revokeObjectURL(K)}j();var M=Ya(),C=ne(M);ka(C,{get apiKey(){return A(l)},onApiModalOpen:f});var h=w(C,2);Ca(h,{get show(){return A(v)},get apiKey(){return A(l)},get error(){return A(i)},onSave:b,onCancel:s});var m=w(h,2);xa(m,{get loading(){return A(d)},onGenerate:p,onUndo:u});var I=w(m,2);{var T=_=>{var g=za(),K=k(g,!0);S(g),U(()=>H(K,A(i))),E(_,g)};V(I,_=>{A(i)&&_(T)})}var $=w(I,2),O=k($);Ma(O,{get prompt(){return A(c)},set prompt(_){x(c,_)},$$legacy:!0});var P=w(O,2);Ka(P,{onDownload:y});var q=w(P,2);Ra(q),S($);var z=w($,2);Ua(z,{}),U(()=>Ce($,1,`container ${r()??""}`)),E(e,M),ee(),o()}export{Wa as component};
