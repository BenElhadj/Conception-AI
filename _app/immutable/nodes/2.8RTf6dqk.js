import"../chunks/DsnmJJEf.js";import{i as Q}from"../chunks/Chyk39w1.js";import{w as Ce,e as Y,s as H,o as Me,g as J}from"../chunks/BGJMIE2G.js";import{h as G,D as Oe,C as Te,i as w,a2 as Ne,F as Re,H as Ke,G as he,I as me,J as se,S as j,aj as De,an as Ge,M as ve,P as Ue,O as W,ar as be,af as He,K as Le,W as V,aM as _e,aN as ze,Q as we,R as Ve,aO as Ye,aP as le,aQ as Ae,aR as Be,aS as qe,al as Je,aT as We,aq as Xe,aU as je,a0 as Fe,aV as Qe,aG as Ze,e as Ie,aI as et,aW as tt,x as Z,t as T,v as L,p as x,y as ee,z as S,A as $,B as A,aL as at,aX as rt,aY as nt,m as Se,o as ne,X as P,j as ye,aZ as ot,a_ as ge}from"../chunks/_bdnPTrJ.js";import{p as K,i as B,s as te,a as ae}from"../chunks/CqBjB8dL.js";import{r as st}from"../chunks/C44ZzWHC.js";function lt(e,a){return a}function it(e,a,t){for(var l=e.items,o=[],s=a.length,c=0;c<s;c++)We(a[c].e,o,!0);var i=s>0&&o.length===0&&t!==null;if(i){var d=t.parentNode;Xe(d),d.append(t),l.clear(),D(e,a[0].prev,a[s-1].next)}je(o,()=>{for(var v=0;v<s;v++){var f=a[v];i||(l.delete(f.k),D(e,f.prev,f.next)),Ae(f.e,!i)}})}function ct(e,a,t,l,o,s=null){var c=e,i={flags:a,items:new Map,first:null};G&&Oe();var d=null,v=!1,f=new Map,b=Ne(()=>{var r=t();return He(r)?r:r==null?[]:be(r)}),n,p;function u(){ut(p,n,i,f,c,o,a,l,t),s!==null&&(n.length===0?d?we(d):d=ve(()=>s(c)):d!==null&&Ve(d,()=>{d=null}))}Te(()=>{p??=Fe,n=w(b);var r=n.length;if(v&&r===0)return;v=r===0;let y=!1;if(G){var M=Re(c)===Ke;M!==(r===0)&&(c=he(),me(c),se(!1),y=!0)}if(G){for(var k=null,h,_=0;_<r;_++){if(j.nodeType===De&&j.data===Ge){c=j,y=!0,se(!1);break}var I=n[_],O=l(I,_);h=de(j,i,k,null,I,O,_,o,a,t),i.items.set(O,h),k=h}r>0&&me(he())}if(G)r===0&&s&&(d=ve(()=>s(c)));else if(Ue()){var E=new Set,N=W;for(_=0;_<r;_+=1){I=n[_],O=l(I,_);var C=i.items.get(O)??f.get(O);C?$e(C,I,_):(h=de(null,i,null,null,I,O,_,o,a,t,!0),f.set(O,h)),E.add(O)}for(const[q,z]of i.items)E.has(q)||N.skipped_effects.add(z.e);N.add_callback(u)}else u();y&&se(!0),w(b)}),G&&(c=j)}function ut(e,a,t,l,o,s,c,i,d){var v=a.length,f=t.items,b=t.first,n=b,p,u=null,r=[],y=[],M,k,h,_;for(_=0;_<v;_+=1){if(M=a[_],k=i(M,_),h=f.get(k),h===void 0){var I=l.get(k);if(I!==void 0){l.delete(k),f.set(k,I);var O=u?u.next:n;D(t,u,I),D(t,I,O),ie(I,O,o),u=I}else{var E=n?n.e.nodes_start:o;u=de(E,t,u,u===null?t.first:u.next,M,k,_,s,c,d)}f.set(k,u),r=[],y=[],n=u.next;continue}if($e(h,M,_),(h.e.f&le)!==0&&we(h.e),h!==n){if(p!==void 0&&p.has(h)){if(r.length<y.length){var N=y[0],C;u=N.prev;var q=r[0],z=r[r.length-1];for(C=0;C<r.length;C+=1)ie(r[C],N,o);for(C=0;C<y.length;C+=1)p.delete(y[C]);D(t,q.prev,z.next),D(t,u,q),D(t,z,N),n=N,u=z,_-=1,r=[],y=[]}else p.delete(h),ie(h,n,o),D(t,h.prev,h.next),D(t,h,u===null?t.first:u.next),D(t,u,h),u=h;continue}for(r=[],y=[];n!==null&&n.k!==k;)(n.e.f&le)===0&&(p??=new Set).add(n),y.push(n),n=n.next;if(n===null)continue;h=n}r.push(h),u=h,n=h.next}if(n!==null||p!==void 0){for(var m=p===void 0?[]:be(p);n!==null;)(n.e.f&le)===0&&m.push(n),n=n.next;var g=m.length;if(g>0){var R=null;it(t,m,R)}}e.first=t.first&&t.first.e,e.last=u&&u.e;for(var U of l.values())Ae(U.e);l.clear()}function $e(e,a,t,l){ze(e.v,a),e.i=t}function de(e,a,t,l,o,s,c,i,d,v,f){var b=(d&Be)!==0,n=(d&qe)===0,p=b?n?V(o,!1,!1):_e(o):o,u=(d&Ye)===0?c:_e(c),r={i:u,v:p,k:s,a:null,e:null,prev:t,next:l};try{if(e===null){var y=document.createDocumentFragment();y.append(e=Le())}return r.e=ve(()=>i(e,p,u,v),G),r.e.prev=t&&t.e,r.e.next=l&&l.e,t===null?f||(a.first=r):(t.next=r,t.e.next=r.e),l!==null&&(l.prev=r,l.e.prev=r.e),r}finally{}}function ie(e,a,t){for(var l=e.next?e.next.e.nodes_start:t,o=a?a.e.nodes_start:t,s=e.e.nodes_start;s!==null&&s!==l;){var c=Je(s);o.before(s),s=c}}function D(e,a,t){a===null?e.first=t:(a.next=t,a.e.next=t&&t.e),t!==null&&(t.prev=a,t.e.prev=a&&a.e)}function vt(e,a,t){var l=e==null?"":""+e;return l===""?null:l}function xe(e,a,t,l,o,s){var c=e.__className;if(G||c!==t||c===void 0){var i=vt(t);(!G||i!==e.getAttribute("class"))&&(i==null?e.removeAttribute("class"):e.className=i),e.__className=t}return s}function ke(e,a,t=a){var l=new WeakSet;Qe(e,"input",async o=>{var s=o?e.defaultValue:e.value;if(s=ce(e)?ue(s):s,t(s),W!==null&&l.add(W),await Ze(),s!==(s=a())){var c=e.selectionStart,i=e.selectionEnd;e.value=s??"",i!==null&&(e.selectionStart=c,e.selectionEnd=Math.min(i,e.value.length))}}),(G&&e.defaultValue!==e.value||Ie(a)==null&&e.value)&&(t(ce(e)?ue(e.value):e.value),W!==null&&l.add(W)),et(()=>{var o=a();if(e===document.activeElement){var s=tt??W;if(l.has(s))return}ce(e)&&o===ue(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function ce(e){var a=e.type;return a==="number"||a==="range"}function ue(e){return e===""?null:+e}const dt="https://api.openai.com/v1/chat/completions";async function ft(e){const a=localStorage.getItem("openai_api_key");if(!a)throw new Error("Clé API OpenAI manquante. Veuillez la fournir dans les paramètres.");const t=await fetch(dt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Tu es un assistant expert qui génère un composant Svelte           utilisable directement dans une div,          toujours dans un fichier .svelte valide.          Retourne exactement un seul bloc .svelte avec :          - une balise <script> (optionnelle mais propre)          - une balise <style> (optionnelle mais propre)          - un bloc HTML racine <div> ou <main>.          N'inclus jamais <html>, <head>, <body>,          ni doctype, ni meta, ni title, ni markdown.          Pas d'import ni export par défaut."},...e],temperature:.7})});if(!t.ok){const s=await t.json();throw new Error(`Erreur API: ${s.error?.message||t.statusText}`)}return((await t.json()).choices?.[0]?.message?.content||"Erreur : aucune réponse valide.").replace(/```svelte|```/g,"").trim()}function oe(e,a){const t=(()=>{try{const o=localStorage.getItem(e);return o?JSON.parse(o):a}catch{return a}})(),l=Ce(t);return l.subscribe(o=>{try{localStorage.setItem(e,JSON.stringify(o))}catch{}}),l}const F=oe("chat_history",[]),re=oe("history_stack",[]),X=oe("generated_code",""),fe=oe("layout_pref","horizontal");var pt=T('<span style="font-size: 1.3rem;">lll</span>'),ht=T('<div class="header"><button class="api-btn"> </button> <h1>Conception AI – Svelte Page Generator</h1> <button><!></button></div>');function mt(e,a){Z(a,!1);const[t,l]=te(),o=()=>ae(fe,"$layout",t);let s=K(a,"apiKey",8,""),c=K(a,"onApiModalOpen",8);function i(){fe.update(r=>r==="horizontal"?"vertical":"horizontal")}Q();var d=ht(),v=S(d),f=S(v,!0);$(v);var b=A(v,4),n=S(b);{var p=r=>{var y=at("≡");x(r,y)},u=r=>{var y=pt();x(r,y)};B(n,r=>{o()==="horizontal"?r(p):r(u,!1)})}$(b),$(d),L(()=>{H(f,s()?"Change API Key":"Add API Key"),xe(b,1,`layout-btn ${o()??""}`)}),Y("click",v,function(...r){c()?.apply(this,r)}),Y("click",b,i),x(e,d),ee(),l()}var _t=T('<p class="modal-error"> </p>'),yt=T('<div class="modal-backdrop"><div class="modal"><h2> </h2> <input type="text" placeholder="Enter your OpenAI API key (sk-...)"/> <!> <div class="modal-actions"><button>Save</button> <button>Cancel</button></div></div></div>');function gt(e,a){Z(a,!1);let t=K(a,"show",8,!1),l=K(a,"apiKey",8,""),o=K(a,"error",8,""),s=K(a,"onSave",8),c=K(a,"onCancel",8),i=V("");function d(){s()(w(i).trim())}rt(()=>(ye(t()),ye(l())),()=>{t()&&P(i,l())}),nt(),Q();var v=Se(),f=ne(v);{var b=n=>{var p=yt(),u=S(p),r=S(u),y=S(r,!0);$(r);var M=A(r,2);st(M);var k=A(M,2);{var h=E=>{var N=_t(),C=S(N,!0);$(N),L(()=>H(C,o())),x(E,N)};B(k,E=>{o()&&E(h)})}var _=A(k,2),I=S(_),O=A(I,2);$(_),$(u),$(p),L(()=>H(y,l()?"Change API Key":"Add API Key")),ke(M,()=>w(i),E=>P(i,E)),Y("click",I,d),Y("click",O,function(...E){c()?.apply(this,E)}),x(n,p)};B(f,n=>{t()&&n(b)})}x(e,v),ee()}var bt=T('<div class="controls"><button> </button> <button>Undo</button></div>');function wt(e,a){Z(a,!1);const[t,l]=te(),o=()=>ae(re,"$historyStack",t);let s=K(a,"loading",8,!1),c=K(a,"onGenerate",8),i=K(a,"onUndo",8);Q();var d=bt(),v=S(d),f=S(v,!0);$(v);var b=A(v,2);$(d),L(()=>{v.disabled=s(),H(f,s()?"Generation...":"Generate new"),b.disabled=(o(),Ie(()=>o().length===0))}),Y("click",v,function(...n){c()?.apply(this,n)}),Y("click",b,function(...n){i()?.apply(this,n)}),x(e,d),ee(),l()}var At=T(`<section class="panel"><h2>Prompt</h2> <textarea placeholder="Describe or refine the page... (e.g., 'Add a red button')"></textarea></section>`);function It(e,a){let t=K(a,"prompt",12,"");var l=At(),o=A(S(l),2);ot(o),$(l),ke(o,t),x(e,l)}var St=T(`
        <code> </code>
      `,1),$t=T("<button>Download .svelte</button>"),xt=T(`<section class="panel"><h2>Generated Code</h2> <pre>
      <!>
    </pre> <!></section>`);function kt(e,a){const[t,l]=te(),o=()=>ae(X,"$generatedCode",t);let s=K(a,"onDownload",8);var c=xt(),i=A(S(c),2),d=A(S(i));{var v=n=>{var p=St(),u=A(ne(p)),r=S(u,!0);$(u),ge(),L(()=>H(r,o())),x(n,p)};B(d,n=>{o()&&n(v)})}ge(),$(i);var f=A(i,2);{var b=n=>{var p=$t();Y("click",p,function(...u){s()?.apply(this,u)}),x(n,p)};B(f,n=>{o()&&n(b)})}$(c),x(e,c),l()}var Et=T('<section class="panel"><h2>Preview</h2> <iframe id="preview-iframe" class="preview" sandbox="allow-scripts" referrerpolicy="no-referrer" title="Preview Generated Code"></iframe></section>');function Pt(e){var a=Et();x(e,a)}var Ct=T('<p style="text-align:center; color:#777;">No messages yet</p>'),Mt=T("<div><strong> </strong> </div>"),Ot=T('<section class="panel"><h2>Conversation History</h2> <!></section>');function Tt(e,a){Z(a,!1);const[t,l]=te(),o=()=>ae(F,"$conversation",t);Q();var s=Ot(),c=A(S(s),2);{var i=v=>{var f=Ct();x(v,f)},d=v=>{var f=Se(),b=ne(f);ct(b,1,o,lt,(n,p)=>{var u=Mt(),r=S(u),y=S(r);$(r);var M=A(r);$(u),L(()=>{H(y,`${w(p).role??""}:`),H(M,` ${w(p).content??""}`)}),x(n,u)}),x(v,f)};B(c,v=>{o().length===0?v(i):v(d,!1)})}$(s),x(e,s),ee(),l()}var Nt=T('<p class="error"> </p>'),Rt=T("<!> <!> <!> <!> <div><!> <!> <!></div> <!>",1);function zt(e,a){Z(a,!1);const[t,l]=te(),o=()=>ae(fe,"$layout",t);let s=V(""),c=V(""),i=V(""),d=V(!1),v=V(!1);Me(()=>{P(s,localStorage.getItem("openai_api_key")||"");const m=J(X);m&&r(m)});function f(){P(v,!0)}function b(m){m&&(P(s,m),localStorage.setItem("openai_api_key",w(s)),P(v,!1),P(i,""),alert("API Key saved."))}function n(){P(v,!1)}async function p(){if(!w(s)){P(i,"Please set your OpenAI API key first You can find your API key at https://platform.openai.com/account/api-keys."),f();return}if(w(c)){P(d,!0),P(i,"");try{const m=[...J(F),{role:"user",content:w(c)}],g=await ft(m);if(g.includes("Erreur"))throw new Error(g);re.update(R=>[...R,{code:J(X),chat:J(F)}]),X.set(g),F.update(R=>[...R,{role:"user",content:w(c)},{role:"assistant",content:g}]),r(g),P(c,"")}catch(m){P(i,m.message),w(i).includes("Incorrect API key provided")&&(P(i,"Erreur API: Incorrect API key provided You can find your API key at https://platform.openai.com/account/api-keys."),f())}finally{P(d,!1)}}}function u(){const m=J(re);if(m.length===0)return;const g=m[m.length-1];re.set(m.slice(0,-1)),X.set(g.code||""),F.set(g.chat||[]),r(g.code||"")}function r(m){try{const g=m.replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<\/?(html|head|body)[^>]*>/gi,""),R=g.match(/<style[^>]*>([\s\S]*?)<\/style>/i),U=g.match(/<script[^>]*>([\s\S]*?)<\/script>/i);let Ee=g.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"");const Pe=`
        <html>
          <head>
            ${R?`<style>${R[1]}</style>`:""}
          </head>
          <body>
            ${Ee}
            ${U?`<script>${U[1]}<\/script>`:""}
          </body>
        </html>
      `,pe=document.getElementById("preview-iframe");pe&&(pe.srcdoc=Pe)}catch(g){P(i,`Render error: ${g.message}`)}}function y(){const m=J(X);if(!m)return;const g=new Blob([m],{type:"text/plain"}),R=URL.createObjectURL(g),U=document.createElement("a");U.href=R,U.download="GeneratedPage.svelte",U.click(),URL.revokeObjectURL(R)}Q();var M=Rt(),k=ne(M);mt(k,{get apiKey(){return w(s)},onApiModalOpen:f});var h=A(k,2);gt(h,{get show(){return w(v)},get apiKey(){return w(s)},get error(){return w(i)},onSave:b,onCancel:n});var _=A(h,2);wt(_,{get loading(){return w(d)},onGenerate:p,onUndo:u});var I=A(_,2);{var O=m=>{var g=Nt(),R=S(g,!0);$(g),L(()=>H(R,w(i))),x(m,g)};B(I,m=>{w(i)&&m(O)})}var E=A(I,2),N=S(E);It(N,{get prompt(){return w(c)},set prompt(m){P(c,m)},$$legacy:!0});var C=A(N,2);kt(C,{onDownload:y});var q=A(C,2);Pt(q),$(E);var z=A(E,2);Tt(z,{}),L(()=>xe(E,1,`container ${o()??""}`)),x(e,M),ee(),l()}export{zt as component};
