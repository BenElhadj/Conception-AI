import"../chunks/DsnmJJEf.js";import{i as X}from"../chunks/D80ivSME.js";import{w as Me,e as J,s as V,c as Oe,o as Ke,g as q}from"../chunks/Cms1OQZ9.js";import{h as U,D as Te,C as Ne,i as S,a2 as De,F as Re,H as Ge,G as ye,I as _e,J as ie,S as ee,am as ze,aO as Ue,M as fe,P as He,O as F,aK as we,aD as Le,K as Be,W as Y,aj as be,al as Je,Q as Ae,R as Ve,a$ as Ye,b0 as ce,au as Ie,b1 as je,b2 as qe,aA as Fe,b3 as We,aJ as Xe,b4 as Qe,a0 as Ze,b5 as ea,af as aa,e as Se,ac as ta,b6 as ra,x as Q,t as M,v as H,p as x,y as Z,z as A,A as I,B as w,ah as na,b7 as oa,b8 as sa,m as Ee,o as se,X as C,j as ge,b9 as la,av as ne}from"../chunks/DFXmt5xk.js";import{p as N,i as j,s as te,a as re}from"../chunks/BRptgZKr.js";import{s as B,r as ia}from"../chunks/_3tV4nvK.js";function ca(e,t){return t}function da(e,t,a){for(var s=e.items,i=[],r=t.length,c=0;c<r;c++)We(t[c].e,i,!0);var n=r>0&&i.length===0&&a!==null;if(n){var v=a.parentNode;Xe(v),v.append(a),s.clear(),z(e,t[0].prev,t[r-1].next)}Qe(i,()=>{for(var d=0;d<r;d++){var f=t[d];n||(s.delete(f.k),z(e,f.prev,f.next)),Ie(f.e,!n)}})}function ua(e,t,a,s,i,r=null){var c=e,n={flags:t,items:new Map,first:null};U&&Te();var v=null,d=!1,f=new Map,b=De(()=>{var o=a();return Le(o)?o:o==null?[]:we(o)}),l,m;function u(){va(m,l,n,f,c,i,t,s,a),r!==null&&(l.length===0?v?Ae(v):v=fe(()=>r(c)):v!==null&&Ve(v,()=>{v=null}))}Ne(()=>{m??=Ze,l=S(b);var o=l.length;if(d&&o===0)return;d=o===0;let p=!1;if(U){var E=Re(c)===Ge;E!==(o===0)&&(c=ye(),_e(c),ie(!1),p=!0)}if(U){for(var k=null,h,_=0;_<o;_++){if(ee.nodeType===ze&&ee.data===Ue){c=ee,p=!0,ie(!1);break}var P=l[_],O=s(P,_);h=pe(ee,n,k,null,P,O,_,i,t,a),n.items.set(O,h),k=h}o>0&&_e(ye())}if(U)o===0&&r&&(v=fe(()=>r(c)));else if(He()){var D=new Set,K=F;for(_=0;_<o;_+=1){P=l[_],O=s(P,_);var $=n.items.get(O)??f.get(O);$?ke($,P,_):(h=pe(null,n,null,null,P,O,_,i,t,a,!0),f.set(O,h)),D.add(O)}for(const[R,G]of n.items)D.has(R)||K.skipped_effects.add(G.e);K.add_callback(u)}else u();p&&ie(!0),S(b)}),U&&(c=ee)}function va(e,t,a,s,i,r,c,n,v){var d=t.length,f=a.items,b=a.first,l=b,m,u=null,o=[],p=[],E,k,h,_;for(_=0;_<d;_+=1){if(E=t[_],k=n(E,_),h=f.get(k),h===void 0){var P=s.get(k);if(P!==void 0){s.delete(k),f.set(k,P);var O=u?u.next:l;z(a,u,P),z(a,P,O),de(P,O,i),u=P}else{var D=l?l.e.nodes_start:i;u=pe(D,a,u,u===null?a.first:u.next,E,k,_,r,c,v)}f.set(k,u),o=[],p=[],l=u.next;continue}if(ke(h,E,_),(h.e.f&ce)!==0&&Ae(h.e),h!==l){if(m!==void 0&&m.has(h)){if(o.length<p.length){var K=p[0],$;u=K.prev;var R=o[0],G=o[o.length-1];for($=0;$<o.length;$+=1)de(o[$],K,i);for($=0;$<p.length;$+=1)m.delete(p[$]);z(a,R.prev,G.next),z(a,u,R),z(a,G,K),l=K,u=G,_-=1,o=[],p=[]}else m.delete(h),de(h,l,i),z(a,h.prev,h.next),z(a,h,u===null?a.first:u.next),z(a,u,h),u=h;continue}for(o=[],p=[];l!==null&&l.k!==k;)(l.e.f&ce)===0&&(m??=new Set).add(l),p.push(l),l=l.next;if(l===null)continue;h=l}o.push(h),u=h,l=h.next}if(l!==null||m!==void 0){for(var y=m===void 0?[]:we(m);l!==null;)(l.e.f&ce)===0&&y.push(l),l=l.next;var g=y.length;if(g>0){var T=null;da(a,y,T)}}e.first=a.first&&a.first.e,e.last=u&&u.e;for(var L of s.values())Ie(L.e);s.clear()}function ke(e,t,a,s){Je(e.v,t),e.i=a}function pe(e,t,a,s,i,r,c,n,v,d,f){var b=(v&je)!==0,l=(v&qe)===0,m=b?l?Y(i,!1,!1):be(i):i,u=(v&Ye)===0?c:be(c),o={i:u,v:m,k:r,a:null,e:null,prev:a,next:s};try{if(e===null){var p=document.createDocumentFragment();p.append(e=Be())}return o.e=fe(()=>n(e,m,u,d),U),o.e.prev=a&&a.e,o.e.next=s&&s.e,a===null?f||(t.first=o):(a.next=o,a.e.next=o.e),s!==null&&(s.prev=o,s.e.prev=o.e),o}finally{}}function de(e,t,a){for(var s=e.next?e.next.e.nodes_start:a,i=t?t.e.nodes_start:a,r=e.e.nodes_start;r!==null&&r!==s;){var c=Fe(r);i.before(r),r=c}}function z(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function fa(e,t,a){var s=e==null?"":""+e;return s===""?null:s}function Pe(e,t,a,s,i,r){var c=e.__className;if(U||c!==a||c===void 0){var n=fa(a);(!U||n!==e.getAttribute("class"))&&(n==null?e.removeAttribute("class"):e.className=n),e.__className=a}return r}function xe(e,t,a=t){var s=new WeakSet;ea(e,"input",async i=>{var r=i?e.defaultValue:e.value;if(r=ue(e)?ve(r):r,a(r),F!==null&&s.add(F),await aa(),r!==(r=t())){var c=e.selectionStart,n=e.selectionEnd,v=e.value.length;if(e.value=r??"",n!==null){var d=e.value.length;c===n&&n===v&&d>v?(e.selectionStart=d,e.selectionEnd=d):(e.selectionStart=c,e.selectionEnd=Math.min(n,d))}}}),(U&&e.defaultValue!==e.value||Se(t)==null&&e.value)&&(a(ue(e)?ve(e.value):e.value),F!==null&&s.add(F)),ta(()=>{var i=t();if(e===document.activeElement){var r=ra??F;if(s.has(r))return}ue(e)&&i===ve(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function ue(e){var t=e.type;return t==="number"||t==="range"}function ve(e){return e===""?null:+e}const pa=!0,ma=!1,ja=Object.freeze(Object.defineProperty({__proto__:null,prerender:pa,ssr:ma},Symbol.toStringTag,{value:"Module"})),ha="https://api.openai.com/v1/chat/completions";async function ya(e){const t=localStorage.getItem("openai_api_key");if(!t)throw new Error("Clé API OpenAI manquante. Veuillez la fournir dans les paramètres.");const a=await fetch(ha,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Tu es un assistant expert qui génère un composant Svelte           utilisable directement dans une div,          toujours dans un fichier .svelte valide.          Retourne exactement un seul bloc .svelte avec :          - une balise <script> (optionnelle mais propre)          - une balise <style> (optionnelle mais propre)          - un bloc HTML racine <div> ou <main>.          N'inclus jamais <html>, <head>, <body>,          ni doctype, ni meta, ni title, ni markdown.          Pas d'import ni export par défaut.          **IMPORTANT :** Tous les éléments de formulaire (input, textarea, select)           doivent avoir des attributs id, name et autocomplete appropriés pour l'accessibilité."},...e],temperature:.7})});if(!a.ok){const r=await a.json();throw new Error(`Erreur API: ${r.error?.message||a.statusText}`)}return((await a.json()).choices?.[0]?.message?.content||"Erreur : aucune réponse valide.").replace(/```svelte|```/g,"").trim()}function le(e,t){const a=(()=>{try{const i=localStorage.getItem(e);return i?JSON.parse(i):t}catch{return t}})(),s=Me(a);return s.subscribe(i=>{try{localStorage.setItem(e,JSON.stringify(i))}catch{}}),s}const ae=le("chat_history",[]),oe=le("history_stack",[]),W=le("generated_code",""),me=le("layout_pref","horizontal");var _a=M('<span class="vertical-layout-icon">lll</span>'),ba=M('<div class="header"><button class="api-btn" type="button"> </button> <h1>Conception AI – Svelte Page Generator</h1> <div class="header-controls"><button type="button"><!></button></div></div>');function ga(e,t){Q(t,!1);const a=()=>re(me,"$layout",s),[s,i]=te();let r=N(t,"apiKey",8,""),c=N(t,"onApiModalOpen",8);function n(){me.update(p=>p==="horizontal"?"vertical":"horizontal")}X();var v=ba(),d=A(v),f=A(d,!0);I(d);var b=w(d,4),l=A(b),m=A(l);{var u=p=>{var E=na("≡");x(p,E)},o=p=>{var E=_a();x(p,E)};j(m,p=>{a()==="horizontal"?p(u):p(o,!1)})}I(l),I(b),I(v),H(()=>{B(d,"aria-label",r()?"Change API Key":"Add API Key"),V(f,r()?"Change API Key":"Add API Key"),Pe(l,1,`layout-btn ${a()??""}`),B(l,"aria-label",a()==="horizontal"?"Switch to vertical layout":"Switch to horizontal layout")}),J("click",d,function(...p){c()?.apply(this,p)}),J("click",l,n),x(e,v),Z(),i()}var wa=M('<p id="api-error" class="modal-error"> </p>'),Aa=M('<div class="modal-backdrop"><div class="modal"><h2> </h2> <label class="sr-only">OpenAI API Key</label> <input type="password" placeholder="Enter your OpenAI API key (sk-...)" name="api_key" autocomplete="new-password"/> <!> <div class="modal-actions"><button type="button">Save</button> <button type="button">Cancel</button></div></div></div>');function Ia(e,t){Q(t,!1);let a=N(t,"show",8,!1),s=N(t,"apiKey",8,""),i=N(t,"error",8,""),r=N(t,"onSave",8),c=N(t,"onCancel",8),n=Y("");const v="api-key-input-main";function d(){r()(S(n).trim())}function f(){C(n,""),c()()}oa(()=>(ge(a()),ge(s())),()=>{a()&&C(n,s())}),sa(),X();var b=Ee(),l=se(b);{var m=u=>{var o=Aa(),p=A(o),E=A(p),k=A(E,!0);I(E);var h=w(E,2);B(h,"for",v);var _=w(h,2);ia(_),B(_,"id",v);var P=w(_,2);{var O=R=>{var G=wa(),y=A(G,!0);I(G),H(()=>V(y,i())),x(R,G)};j(P,R=>{i()&&R(O)})}var D=w(P,2),K=A(D),$=w(K,2);I(D),I(p),I(o),H(()=>{V(k,s()?"Change API Key":"Add API Key"),B(_,"aria-describedby",i()?"api-error":void 0)}),xe(_,()=>S(n),R=>C(n,R)),J("click",K,d),J("click",$,f),x(u,o)};j(l,u=>{a()&&u(m)})}x(e,b),Z()}var Sa=M('<div class="controls"><button type="button"> </button> <button type="button" aria-label="Undo last generation">Undo</button></div>');function Ea(e,t){Q(t,!1);const a=()=>re(oe,"$historyStack",s),[s,i]=te();let r=N(t,"loading",8,!1),c=N(t,"onGenerate",8),n=N(t,"onUndo",8);X();var v=Sa(),d=A(v),f=A(d,!0);I(d);var b=w(d,2);I(v),H(()=>{d.disabled=r(),B(d,"aria-label",r()?"Generating code...":"Generate new code"),V(f,r()?"Generation...":"Generate new"),b.disabled=(a(),Se(()=>a().length===0))}),J("click",d,function(...l){c()?.apply(this,l)}),J("click",b,function(...l){n()?.apply(this,l)}),x(e,v),Z(),i()}var ka=M(`<section class="panel"><h2>Prompt</h2> <label class="sr-only">Enter your prompt to generate Svelte code</label> <textarea name="user_prompt" placeholder="Describe or refine the page... (e.g., 'Add a red button') - Press Enter to generate" autocomplete="off" rows="4"></textarea> <div class="help-text"><small>Press Enter to generate • Shift+Enter for new line</small></div></section>`);function Pa(e,t){Q(t,!1);let a=N(t,"prompt",12,""),s=N(t,"loading",8,!1);const i="prompt-textarea-main",r=Oe();function c(f){(f.key==="Enter"&&(f.ctrlKey||f.metaKey)||f.key==="Enter"&&!f.shiftKey)&&(f.preventDefault(),!s()&&a().trim()&&r("submit"))}X();var n=ka(),v=w(A(n),2);B(v,"for",i);var d=w(v,2);la(d),B(d,"id",i),ne(2),I(n),H(()=>d.disabled=s()),xe(d,a),J("keydown",d,c),x(e,n),Z()}var xa=M(`
            <code> </code>
        `,1),Ca=M(`
            <code class="no-code">No code generated yet</code>
        `,1),$a=M('<button type="button" aria-label="Download generated Svelte component" class="btn btn-primary">Download .svelte</button>'),Ma=M(`<section class="panel"><h2>Generated Code</h2> <pre aria-live="polite" aria-atomic="true">
        <!>
    </pre> <!></section>`);function Oa(e,t){const a=()=>re(W,"$generatedCode",s),[s,i]=te();let r=N(t,"onDownload",8);var c=Ma(),n=w(A(c),2),v=w(A(n));{var d=m=>{var u=xa(),o=w(se(u)),p=A(o,!0);I(o),ne(),H(()=>V(p,a())),x(m,u)},f=m=>{var u=Ca();ne(2),x(m,u)};j(v,m=>{a()?m(d):m(f,!1)})}ne(),I(n);var b=w(n,2);{var l=m=>{var u=$a();J("click",u,function(...o){r()?.apply(this,o)}),x(m,u)};j(b,m=>{a()&&m(l)})}I(c),x(e,c),i()}var Ka=M('<section class="panel"><h2>Preview</h2> <div class="preview-info"><p><small>Note: Accessibility warnings in the preview are normal and come from the AI-generated code.</small></p></div> <iframe id="preview-iframe" class="preview" sandbox="allow-scripts" referrerpolicy="no-referrer" title="Preview Generated Code" aria-label="Live preview of generated Svelte code" loading="lazy"></iframe></section>');function Ta(e){var t=Ka();x(e,t)}var Na=M('<p class="empty-message">No messages yet</p>'),Da=M('<div class="message" role="article"><strong> </strong> <span> </span></div>'),Ra=M('<section class="panel" aria-labelledby="conversation-heading"><h2 id="conversation-heading">Conversation History</h2> <div role="log" aria-live="polite"><!></div></section>');function Ga(e,t){Q(t,!1);const a=()=>re(ae,"$conversation",s),[s,i]=te();X();var r=Ra(),c=w(A(r),2),n=A(c);{var v=f=>{var b=Na();x(f,b)},d=f=>{var b=Ee(),l=se(b);ua(l,1,a,ca,(m,u)=>{var o=Da(),p=A(o),E=A(p);I(p);var k=w(p,2),h=A(k,!0);I(k),I(o),H(()=>{V(E,`${S(u).role??""}:`),V(h,S(u).content)}),x(m,o)}),x(f,b)};j(n,f=>{a().length===0?f(v):f(d,!1)})}I(c),I(r),x(e,r),Z(),i()}var za=M('<p class="text-error"> </p>'),Ua=M("<!> <!> <!> <!> <div><!> <!> <!></div> <!>",1);function qa(e,t){Q(t,!1);const a=()=>re(me,"$layout",s),[s,i]=te();let r=Y(""),c=Y(""),n=Y(""),v=Y(!1),d=Y(!1);Ke(()=>{C(r,localStorage.getItem("openai_api_key")||"");const y=q(W);y&&o(y)});function f(){C(d,!0)}function b(y){y&&(C(r,y),localStorage.setItem("openai_api_key",S(r)),C(d,!1),C(n,""),alert("API Key saved."))}function l(){C(d,!1)}async function m(){if(!S(r)){C(n,"Please set your OpenAI API key first You can find your API key at https://platform.openai.com/account/api-keys."),f();return}if(S(c)){C(v,!0),C(n,"");try{const y=[...q(ae),{role:"user",content:S(c)}],g=await ya(y);if(g.includes("Erreur"))throw new Error(g);oe.update(T=>[...T,{code:q(W),chat:q(ae)}]),W.set(g),ae.update(T=>[...T,{role:"user",content:S(c)},{role:"assistant",content:g}]),o(g),C(c,"")}catch(y){C(n,y.message),S(n).includes("Incorrect API key provided")&&(C(n,"Erreur API: Incorrect API key provided You can find your API key at https://platform.openai.com/account/api-keys."),f())}finally{C(v,!1)}}}function u(){const y=q(oe);if(y.length===0)return;const g=y[y.length-1];oe.set(y.slice(0,-1)),W.set(g.code||""),ae.set(g.chat||[]),o(g.code||"")}function o(y){try{const g=y.replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<\/?(html|head|body)[^>]*>/gi,""),T=g.match(/<style[^>]*>([\s\S]*?)<\/style>/i),L=g.match(/<script[^>]*>([\s\S]*?)<\/script>/i);let Ce=g.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"");const $e=`
        <html>
          <head>
            ${T?`<style>${T[1]}</style>`:""}
          </head>
          <body>
            ${Ce}
            ${L?`<script>${L[1]}<\/script>`:""}
          </body>
        </html>
      `,he=document.getElementById("preview-iframe");he&&(he.srcdoc=$e)}catch(g){C(n,`Render error: ${g.message}`)}}function p(){const y=q(W);if(!y)return;const g=new Blob([y],{type:"text/plain"}),T=URL.createObjectURL(g),L=document.createElement("a");L.href=T,L.download="GeneratedPage.svelte",L.click(),URL.revokeObjectURL(T)}X();var E=Ua(),k=se(E);ga(k,{get apiKey(){return S(r)},onApiModalOpen:f});var h=w(k,2);Ia(h,{get show(){return S(d)},get apiKey(){return S(r)},get error(){return S(n)},onSave:b,onCancel:l});var _=w(h,2);Ea(_,{get loading(){return S(v)},onGenerate:m,onUndo:u});var P=w(_,2);{var O=y=>{var g=za(),T=A(g,!0);I(g),H(()=>V(T,S(n))),x(y,g)};j(P,y=>{S(n)&&y(O)})}var D=w(P,2),K=A(D);Pa(K,{get loading(){return S(v)},get prompt(){return S(c)},set prompt(y){C(c,y)},$$events:{submit:m},$$legacy:!0});var $=w(K,2);Oa($,{onDownload:p});var R=w($,2);Ta(R),I(D);var G=w(D,2);Ga(G,{}),H(()=>Pe(D,1,`container ${a()??""}`)),x(e,E),Z(),i()}export{qa as component,ja as universal};
