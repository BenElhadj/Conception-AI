import"../chunks/DsnmJJEf.js";import{i as Q}from"../chunks/18xEWTec.js";import{w as Ee,e as J,s as U,o as Pe,g as q}from"../chunks/D-bie2bq.js";import{h as G,D as Ce,C as Me,i as A,a2 as Oe,F as Te,H as Ne,G as pe,I as he,J as se,S as W,am as Ke,aO as De,M as ue,P as Re,O as j,aK as ge,aD as Ge,K as He,W as B,aj as me,al as Ue,Q as be,R as Le,a$ as ze,b0 as le,au as Ae,b1 as Be,b2 as Je,aA as Ve,b3 as Ye,aJ as qe,b4 as je,a0 as Fe,b5 as We,af as Xe,e as we,ac as Qe,b6 as Ze,x as Z,t as T,v as L,p as k,y as ee,z as $,A as S,B as w,ah as et,b7 as tt,b8 as at,m as Ie,o as ne,X as P,j as _e,b9 as rt,av as ye}from"../chunks/Cbqb5KLJ.js";import{p as D,i as V,s as te,a as ae}from"../chunks/BQ1Wj4N3.js";import{r as nt}from"../chunks/cN3y8ZJr.js";function ot(e,a){return a}function st(e,a,t){for(var s=e.items,i=[],o=a.length,c=0;c<o;c++)Ye(a[c].e,i,!0);var l=o>0&&i.length===0&&t!==null;if(l){var d=t.parentNode;qe(d),d.append(t),s.clear(),R(e,a[0].prev,a[o-1].next)}je(i,()=>{for(var v=0;v<o;v++){var f=a[v];l||(s.delete(f.k),R(e,f.prev,f.next)),Ae(f.e,!l)}})}function lt(e,a,t,s,i,o=null){var c=e,l={flags:a,items:new Map,first:null};G&&Ce();var d=null,v=!1,f=new Map,b=Oe(()=>{var r=t();return Ge(r)?r:r==null?[]:ge(r)}),n,p;function u(){it(p,n,l,f,c,i,a,s,t),o!==null&&(n.length===0?d?be(d):d=ue(()=>o(c)):d!==null&&Le(d,()=>{d=null}))}Me(()=>{p??=Fe,n=A(b);var r=n.length;if(v&&r===0)return;v=r===0;let y=!1;if(G){var M=Te(c)===Ne;M!==(r===0)&&(c=pe(),he(c),se(!1),y=!0)}if(G){for(var x=null,h,_=0;_<r;_++){if(W.nodeType===Ke&&W.data===De){c=W,y=!0,se(!1);break}var I=n[_],O=s(I,_);h=de(W,l,x,null,I,O,_,i,a,t),l.items.set(O,h),x=h}r>0&&he(pe())}if(G)r===0&&o&&(d=ue(()=>o(c)));else if(Re()){var E=new Set,N=j;for(_=0;_<r;_+=1){I=n[_],O=s(I,_);var C=l.items.get(O)??f.get(O);C?$e(C,I,_):(h=de(null,l,null,null,I,O,_,i,a,t,!0),f.set(O,h)),E.add(O)}for(const[Y,z]of l.items)E.has(Y)||N.skipped_effects.add(z.e);N.add_callback(u)}else u();y&&se(!0),A(b)}),G&&(c=W)}function it(e,a,t,s,i,o,c,l,d){var v=a.length,f=t.items,b=t.first,n=b,p,u=null,r=[],y=[],M,x,h,_;for(_=0;_<v;_+=1){if(M=a[_],x=l(M,_),h=f.get(x),h===void 0){var I=s.get(x);if(I!==void 0){s.delete(x),f.set(x,I);var O=u?u.next:n;R(t,u,I),R(t,I,O),ie(I,O,i),u=I}else{var E=n?n.e.nodes_start:i;u=de(E,t,u,u===null?t.first:u.next,M,x,_,o,c,d)}f.set(x,u),r=[],y=[],n=u.next;continue}if($e(h,M,_),(h.e.f&le)!==0&&be(h.e),h!==n){if(p!==void 0&&p.has(h)){if(r.length<y.length){var N=y[0],C;u=N.prev;var Y=r[0],z=r[r.length-1];for(C=0;C<r.length;C+=1)ie(r[C],N,i);for(C=0;C<y.length;C+=1)p.delete(y[C]);R(t,Y.prev,z.next),R(t,u,Y),R(t,z,N),n=N,u=z,_-=1,r=[],y=[]}else p.delete(h),ie(h,n,i),R(t,h.prev,h.next),R(t,h,u===null?t.first:u.next),R(t,u,h),u=h;continue}for(r=[],y=[];n!==null&&n.k!==x;)(n.e.f&le)===0&&(p??=new Set).add(n),y.push(n),n=n.next;if(n===null)continue;h=n}r.push(h),u=h,n=h.next}if(n!==null||p!==void 0){for(var m=p===void 0?[]:ge(p);n!==null;)(n.e.f&le)===0&&m.push(n),n=n.next;var g=m.length;if(g>0){var K=null;st(t,m,K)}}e.first=t.first&&t.first.e,e.last=u&&u.e;for(var H of s.values())Ae(H.e);s.clear()}function $e(e,a,t,s){Ue(e.v,a),e.i=t}function de(e,a,t,s,i,o,c,l,d,v,f){var b=(d&Be)!==0,n=(d&Je)===0,p=b?n?B(i,!1,!1):me(i):i,u=(d&ze)===0?c:me(c),r={i:u,v:p,k:o,a:null,e:null,prev:t,next:s};try{if(e===null){var y=document.createDocumentFragment();y.append(e=He())}return r.e=ue(()=>l(e,p,u,v),G),r.e.prev=t&&t.e,r.e.next=s&&s.e,t===null?f||(a.first=r):(t.next=r,t.e.next=r.e),s!==null&&(s.prev=r,s.e.prev=r.e),r}finally{}}function ie(e,a,t){for(var s=e.next?e.next.e.nodes_start:t,i=a?a.e.nodes_start:t,o=e.e.nodes_start;o!==null&&o!==s;){var c=Ve(o);i.before(o),o=c}}function R(e,a,t){a===null?e.first=t:(a.next=t,a.e.next=t&&t.e),t!==null&&(t.prev=a,t.e.prev=a&&a.e)}function ct(e,a,t){var s=e==null?"":""+e;return s===""?null:s}function Se(e,a,t,s,i,o){var c=e.__className;if(G||c!==t||c===void 0){var l=ct(t);(!G||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):e.className=l),e.__className=t}return o}function ke(e,a,t=a){var s=new WeakSet;We(e,"input",async i=>{var o=i?e.defaultValue:e.value;if(o=ce(e)?ve(o):o,t(o),j!==null&&s.add(j),await Xe(),o!==(o=a())){var c=e.selectionStart,l=e.selectionEnd,d=e.value.length;if(e.value=o??"",l!==null){var v=e.value.length;c===l&&l===d&&v>d?(e.selectionStart=v,e.selectionEnd=v):(e.selectionStart=c,e.selectionEnd=Math.min(l,v))}}}),(G&&e.defaultValue!==e.value||we(a)==null&&e.value)&&(t(ce(e)?ve(e.value):e.value),j!==null&&s.add(j)),Qe(()=>{var i=a();if(e===document.activeElement){var o=Ze??j;if(s.has(o))return}ce(e)&&i===ve(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function ce(e){var a=e.type;return a==="number"||a==="range"}function ve(e){return e===""?null:+e}const vt="https://api.openai.com/v1/chat/completions";async function ut(e){const a=localStorage.getItem("openai_api_key");if(!a)throw new Error("Clé API OpenAI manquante. Veuillez la fournir dans les paramètres.");const t=await fetch(vt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Tu es un assistant expert qui génère un composant Svelte           utilisable directement dans une div,          toujours dans un fichier .svelte valide.          Retourne exactement un seul bloc .svelte avec :          - une balise <script> (optionnelle mais propre)          - une balise <style> (optionnelle mais propre)          - un bloc HTML racine <div> ou <main>.          N'inclus jamais <html>, <head>, <body>,          ni doctype, ni meta, ni title, ni markdown.          Pas d'import ni export par défaut."},...e],temperature:.7})});if(!t.ok){const o=await t.json();throw new Error(`Erreur API: ${o.error?.message||t.statusText}`)}return((await t.json()).choices?.[0]?.message?.content||"Erreur : aucune réponse valide.").replace(/```svelte|```/g,"").trim()}function oe(e,a){const t=(()=>{try{const i=localStorage.getItem(e);return i?JSON.parse(i):a}catch{return a}})(),s=Ee(t);return s.subscribe(i=>{try{localStorage.setItem(e,JSON.stringify(i))}catch{}}),s}const X=oe("chat_history",[]),re=oe("history_stack",[]),F=oe("generated_code",""),fe=oe("layout_pref","horizontal");var dt=T('<span style="font-size: 1.3rem;">lll</span>'),ft=T('<div class="header"><button class="api-btn"> </button> <h1>Conception AI – Svelte Page Generator</h1> <button><!></button></div>');function pt(e,a){Z(a,!1);const t=()=>ae(fe,"$layout",s),[s,i]=te();let o=D(a,"apiKey",8,""),c=D(a,"onApiModalOpen",8);function l(){fe.update(r=>r==="horizontal"?"vertical":"horizontal")}Q();var d=ft(),v=$(d),f=$(v,!0);S(v);var b=w(v,4),n=$(b);{var p=r=>{var y=et("≡");k(r,y)},u=r=>{var y=dt();k(r,y)};V(n,r=>{t()==="horizontal"?r(p):r(u,!1)})}S(b),S(d),L(()=>{U(f,o()?"Change API Key":"Add API Key"),Se(b,1,`layout-btn ${t()??""}`)}),J("click",v,function(...r){c()?.apply(this,r)}),J("click",b,l),k(e,d),ee(),i()}var ht=T('<p class="modal-error"> </p>'),mt=T('<div class="modal-backdrop"><div class="modal"><h2> </h2> <input type="text" placeholder="Enter your OpenAI API key (sk-...)"/> <!> <div class="modal-actions"><button>Save</button> <button>Cancel</button></div></div></div>');function _t(e,a){Z(a,!1);let t=D(a,"show",8,!1),s=D(a,"apiKey",8,""),i=D(a,"error",8,""),o=D(a,"onSave",8),c=D(a,"onCancel",8),l=B("");function d(){o()(A(l).trim())}tt(()=>(_e(t()),_e(s())),()=>{t()&&P(l,s())}),at(),Q();var v=Ie(),f=ne(v);{var b=n=>{var p=mt(),u=$(p),r=$(u),y=$(r,!0);S(r);var M=w(r,2);nt(M);var x=w(M,2);{var h=E=>{var N=ht(),C=$(N,!0);S(N),L(()=>U(C,i())),k(E,N)};V(x,E=>{i()&&E(h)})}var _=w(x,2),I=$(_),O=w(I,2);S(_),S(u),S(p),L(()=>U(y,s()?"Change API Key":"Add API Key")),ke(M,()=>A(l),E=>P(l,E)),J("click",I,d),J("click",O,function(...E){c()?.apply(this,E)}),k(n,p)};V(f,n=>{t()&&n(b)})}k(e,v),ee()}var yt=T('<div class="controls"><button> </button> <button>Undo</button></div>');function gt(e,a){Z(a,!1);const t=()=>ae(re,"$historyStack",s),[s,i]=te();let o=D(a,"loading",8,!1),c=D(a,"onGenerate",8),l=D(a,"onUndo",8);Q();var d=yt(),v=$(d),f=$(v,!0);S(v);var b=w(v,2);S(d),L(()=>{v.disabled=o(),U(f,o()?"Generation...":"Generate new"),b.disabled=(t(),we(()=>t().length===0))}),J("click",v,function(...n){c()?.apply(this,n)}),J("click",b,function(...n){l()?.apply(this,n)}),k(e,d),ee(),i()}var bt=T(`<section class="panel"><h2>Prompt</h2> <textarea placeholder="Describe or refine the page... (e.g., 'Add a red button')"></textarea></section>`);function At(e,a){let t=D(a,"prompt",12,"");var s=bt(),i=w($(s),2);rt(i),S(s),ke(i,t),k(e,s)}var wt=T(`
        <code> </code>
      `,1),It=T("<button>Download .svelte</button>"),$t=T(`<section class="panel"><h2>Generated Code</h2> <pre>
      <!>
    </pre> <!></section>`);function St(e,a){const t=()=>ae(F,"$generatedCode",s),[s,i]=te();let o=D(a,"onDownload",8);var c=$t(),l=w($(c),2),d=w($(l));{var v=n=>{var p=wt(),u=w(ne(p)),r=$(u,!0);S(u),ye(),L(()=>U(r,t())),k(n,p)};V(d,n=>{t()&&n(v)})}ye(),S(l);var f=w(l,2);{var b=n=>{var p=It();J("click",p,function(...u){o()?.apply(this,u)}),k(n,p)};V(f,n=>{t()&&n(b)})}S(c),k(e,c),i()}var kt=T('<section class="panel"><h2>Preview</h2> <iframe id="preview-iframe" class="preview" sandbox="allow-scripts" referrerpolicy="no-referrer" title="Preview Generated Code"></iframe></section>');function xt(e){var a=kt();k(e,a)}var Et=T('<p style="text-align:center; color:#777;">No messages yet</p>'),Pt=T("<div><strong> </strong> </div>"),Ct=T('<section class="panel"><h2>Conversation History</h2> <!></section>');function Mt(e,a){Z(a,!1);const t=()=>ae(X,"$conversation",s),[s,i]=te();Q();var o=Ct(),c=w($(o),2);{var l=v=>{var f=Et();k(v,f)},d=v=>{var f=Ie(),b=ne(f);lt(b,1,t,ot,(n,p)=>{var u=Pt(),r=$(u),y=$(r);S(r);var M=w(r);S(u),L(()=>{U(y,`${A(p).role??""}:`),U(M,` ${A(p).content??""}`)}),k(n,u)}),k(v,f)};V(c,v=>{t().length===0?v(l):v(d,!1)})}S(o),k(e,o),ee(),i()}var Ot=T('<p class="error"> </p>'),Tt=T("<!> <!> <!> <!> <div><!> <!> <!></div> <!>",1);function zt(e,a){Z(a,!1);const t=()=>ae(fe,"$layout",s),[s,i]=te();let o=B(""),c=B(""),l=B(""),d=B(!1),v=B(!1);Pe(()=>{P(o,localStorage.getItem("openai_api_key")||"");const m=q(F);m&&r(m)});function f(){P(v,!0)}function b(m){m&&(P(o,m),localStorage.setItem("openai_api_key",A(o)),P(v,!1),P(l,""),alert("API Key saved."))}function n(){P(v,!1)}async function p(){if(!A(o)){P(l,"Please set your OpenAI API key first You can find your API key at https://platform.openai.com/account/api-keys."),f();return}if(A(c)){P(d,!0),P(l,"");try{const m=[...q(X),{role:"user",content:A(c)}],g=await ut(m);if(g.includes("Erreur"))throw new Error(g);re.update(K=>[...K,{code:q(F),chat:q(X)}]),F.set(g),X.update(K=>[...K,{role:"user",content:A(c)},{role:"assistant",content:g}]),r(g),P(c,"")}catch(m){P(l,m.message),A(l).includes("Incorrect API key provided")&&(P(l,"Erreur API: Incorrect API key provided You can find your API key at https://platform.openai.com/account/api-keys."),f())}finally{P(d,!1)}}}function u(){const m=q(re);if(m.length===0)return;const g=m[m.length-1];re.set(m.slice(0,-1)),F.set(g.code||""),X.set(g.chat||[]),r(g.code||"")}function r(m){try{const g=m.replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<\/?(html|head|body)[^>]*>/gi,""),K=g.match(/<style[^>]*>([\s\S]*?)<\/style>/i),H=g.match(/<script[^>]*>([\s\S]*?)<\/script>/i);let xe=g.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"");const Nt=`
        <html>
          <head>
            ${K?`<style>${K[1]}</style>`:""}
          </head>
          <body>
            ${xe}
            ${H?`<script>${H[1]}<\/script>`:""}
          </body>
        </html>
      `;if(!document.getElementById("preview-iframe")){console.error("Preview iframe not found");return}}catch(g){P(l,`Render error: ${g.message}`)}}function y(){const m=q(F);if(!m)return;const g=new Blob([m],{type:"text/plain"}),K=URL.createObjectURL(g),H=document.createElement("a");H.href=K,H.download="GeneratedPage.svelte",H.click(),URL.revokeObjectURL(K)}Q();var M=Tt(),x=ne(M);pt(x,{get apiKey(){return A(o)},onApiModalOpen:f});var h=w(x,2);_t(h,{get show(){return A(v)},get apiKey(){return A(o)},get error(){return A(l)},onSave:b,onCancel:n});var _=w(h,2);gt(_,{get loading(){return A(d)},onGenerate:p,onUndo:u});var I=w(_,2);{var O=m=>{var g=Ot(),K=$(g,!0);S(g),L(()=>U(K,A(l))),k(m,g)};V(I,m=>{A(l)&&m(O)})}var E=w(I,2),N=$(E);At(N,{get prompt(){return A(c)},set prompt(m){P(c,m)},$$legacy:!0});var C=w(N,2);St(C,{onDownload:y});var Y=w(C,2);xt(Y),S(E);var z=w(E,2);Mt(z,{}),L(()=>Se(E,1,`container ${t()??""}`)),k(e,M),ee(),i()}export{zt as component};
