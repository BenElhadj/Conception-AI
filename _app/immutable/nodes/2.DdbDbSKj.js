import"../chunks/DsnmJJEf.js";import{i as Q}from"../chunks/D80ivSME.js";import{w as Ne,e as B,s as J,c as De,o as Re,g as F}from"../chunks/Cms1OQZ9.js";import{h as H,D as Ge,C as ze,i as A,a2 as Ue,F as He,H as Le,G as Ae,I as Ie,J as ue,S as ae,am as Ye,aO as Be,M as ye,P as Je,O as W,aK as ke,aD as Ve,K as je,W as V,aj as Se,al as qe,Q as Pe,R as Fe,a$ as We,b0 as fe,au as xe,b1 as Xe,b2 as Qe,aA as Ze,b3 as ea,aJ as aa,b4 as ta,a0 as ra,b5 as na,af as oa,e as Ce,ac as sa,b6 as la,x as Z,t as $,v as L,p as x,y as ee,z as _,A as b,B as I,ah as ia,b7 as ca,b8 as va,m as $e,o as ie,X as C,j as Ee,b9 as da,av as se}from"../chunks/DFXmt5xk.js";import{p as N,i as j,s as re,a as ne}from"../chunks/BRptgZKr.js";import{s as Y,r as ua}from"../chunks/_3tV4nvK.js";function fa(e,t){return t}function pa(e,t,a){for(var n=e.items,i=[],r=t.length,c=0;c<r;c++)ea(t[c].e,i,!0);var o=r>0&&i.length===0&&a!==null;if(o){var u=a.parentNode;aa(u),u.append(a),n.clear(),z(e,t[0].prev,t[r-1].next)}ta(i,()=>{for(var d=0;d<r;d++){var f=t[d];o||(n.delete(f.k),z(e,f.prev,f.next)),xe(f.e,!o)}})}function ma(e,t,a,n,i,r=null){var c=e,o={flags:t,items:new Map,first:null};H&&Ge();var u=null,d=!1,f=new Map,w=Ue(()=>{var s=a();return Ve(s)?s:s==null?[]:ke(s)}),l,m;function v(){ha(m,l,o,f,c,i,t,n,a),r!==null&&(l.length===0?u?Pe(u):u=ye(()=>r(c)):u!==null&&Fe(u,()=>{u=null}))}ze(()=>{m??=ra,l=A(w);var s=l.length;if(d&&s===0)return;d=s===0;let p=!1;if(H){var E=He(c)===Le;E!==(s===0)&&(c=Ae(),Ie(c),ue(!1),p=!0)}if(H){for(var k=null,h,y=0;y<s;y++){if(ae.nodeType===Ye&&ae.data===Be){c=ae,p=!0,ue(!1);break}var P=l[y],M=n(P,y);h=_e(ae,o,k,null,P,M,y,i,t,a),o.items.set(M,h),k=h}s>0&&Ie(Ae())}if(H)s===0&&r&&(u=ye(()=>r(c)));else if(Je()){var D=new Set,K=W;for(y=0;y<s;y+=1){P=l[y],M=n(P,y);var O=o.items.get(M)??f.get(M);O?Me(O,P,y):(h=_e(null,o,null,null,P,M,y,i,t,a,!0),f.set(M,h)),D.add(M)}for(const[T,R]of o.items)D.has(T)||K.skipped_effects.add(R.e);K.add_callback(v)}else v();p&&ue(!0),A(w)}),H&&(c=ae)}function ha(e,t,a,n,i,r,c,o,u){var d=t.length,f=a.items,w=a.first,l=w,m,v=null,s=[],p=[],E,k,h,y;for(y=0;y<d;y+=1){if(E=t[y],k=o(E,y),h=f.get(k),h===void 0){var P=n.get(k);if(P!==void 0){n.delete(k),f.set(k,P);var M=v?v.next:l;z(a,v,P),z(a,P,M),pe(P,M,i),v=P}else{var D=l?l.e.nodes_start:i;v=_e(D,a,v,v===null?a.first:v.next,E,k,y,r,c,u)}f.set(k,v),s=[],p=[],l=v.next;continue}if(Me(h,E,y),(h.e.f&fe)!==0&&Pe(h.e),h!==l){if(m!==void 0&&m.has(h)){if(s.length<p.length){var K=p[0],O;v=K.prev;var T=s[0],R=s[s.length-1];for(O=0;O<s.length;O+=1)pe(s[O],K,i);for(O=0;O<p.length;O+=1)m.delete(p[O]);z(a,T.prev,R.next),z(a,v,T),z(a,R,K),l=K,v=R,y-=1,s=[],p=[]}else m.delete(h),pe(h,l,i),z(a,h.prev,h.next),z(a,h,v===null?a.first:v.next),z(a,v,h),v=h;continue}for(s=[],p=[];l!==null&&l.k!==k;)(l.e.f&fe)===0&&(m??=new Set).add(l),p.push(l),l=l.next;if(l===null)continue;h=l}s.push(h),v=h,l=h.next}if(l!==null||m!==void 0){for(var U=m===void 0?[]:ke(m);l!==null;)(l.e.f&fe)===0&&U.push(l),l=l.next;var ve=U.length;if(ve>0){var oe=null;pa(a,U,oe)}}e.first=a.first&&a.first.e,e.last=v&&v.e;for(var de of n.values())xe(de.e);n.clear()}function Me(e,t,a,n){qe(e.v,t),e.i=a}function _e(e,t,a,n,i,r,c,o,u,d,f){var w=(u&Xe)!==0,l=(u&Qe)===0,m=w?l?V(i,!1,!1):Se(i):i,v=(u&We)===0?c:Se(c),s={i:v,v:m,k:r,a:null,e:null,prev:a,next:n};try{if(e===null){var p=document.createDocumentFragment();p.append(e=je())}return s.e=ye(()=>o(e,m,v,d),H),s.e.prev=a&&a.e,s.e.next=n&&n.e,a===null?f||(t.first=s):(a.next=s,a.e.next=s.e),n!==null&&(n.prev=s,n.e.prev=s.e),s}finally{}}function pe(e,t,a){for(var n=e.next?e.next.e.nodes_start:a,i=t?t.e.nodes_start:a,r=e.e.nodes_start;r!==null&&r!==n;){var c=Ze(r);i.before(r),r=c}}function z(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function ya(e,t,a){var n=e==null?"":""+e;return t&&(n=n?n+" "+t:t),n===""?null:n}function ge(e,t,a,n,i,r){var c=e.__className;if(H||c!==a||c===void 0){var o=ya(a,n);(!H||o!==e.getAttribute("class"))&&(o==null?e.removeAttribute("class"):e.className=o),e.__className=a}return r}function Oe(e,t,a=t){var n=new WeakSet;na(e,"input",async i=>{var r=i?e.defaultValue:e.value;if(r=me(e)?he(r):r,a(r),W!==null&&n.add(W),await oa(),r!==(r=t())){var c=e.selectionStart,o=e.selectionEnd,u=e.value.length;if(e.value=r??"",o!==null){var d=e.value.length;c===o&&o===u&&d>u?(e.selectionStart=d,e.selectionEnd=d):(e.selectionStart=c,e.selectionEnd=Math.min(o,d))}}}),(H&&e.defaultValue!==e.value||Ce(t)==null&&e.value)&&(a(me(e)?he(e.value):e.value),W!==null&&n.add(W)),sa(()=>{var i=t();if(e===document.activeElement){var r=la??W;if(n.has(r))return}me(e)&&i===he(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function me(e){var t=e.type;return t==="number"||t==="range"}function he(e){return e===""?null:+e}const _a=!0,ba=!1,Xa=Object.freeze(Object.defineProperty({__proto__:null,prerender:_a,ssr:ba},Symbol.toStringTag,{value:"Module"})),ga="https://api.openai.com/v1/chat/completions";async function wa(e){const t=localStorage.getItem("openai_api_key");if(!t)throw new Error("Cl√© API OpenAI manquante. Veuillez la fournir dans les param√®tres.");const a=await fetch(ga,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Tu es un assistant expert qui g√©n√®re un composant Svelte           utilisable directement dans une div,          toujours dans un fichier .svelte valide.          Retourne exactement un seul bloc .svelte avec :          - une balise <script> (optionnelle mais propre)          - une balise <style> (optionnelle mais propre)          - un bloc HTML racine <div> ou <main>.          N'inclus jamais <html>, <head>, <body>,          ni doctype, ni meta, ni title, ni markdown.          Pas d'import ni export par d√©faut.          **IMPORTANT :** Tous les √©l√©ments de formulaire (input, textarea, select)           doivent avoir des attributs id, name et autocomplete appropri√©s pour l'accessibilit√©."},...e],temperature:.7})});if(!a.ok){const r=await a.json();throw new Error(`Erreur API: ${r.error?.message||a.statusText}`)}return((await a.json()).choices?.[0]?.message?.content||"Erreur : aucune r√©ponse valide.").replace(/```svelte|```/g,"").trim()}function ce(e,t){const a=(()=>{try{const i=localStorage.getItem(e);return i?JSON.parse(i):t}catch{return t}})(),n=Ne(a);return n.subscribe(i=>{try{localStorage.setItem(e,JSON.stringify(i))}catch{}}),n}const te=ce("chat_history",[]),le=ce("history_stack",[]),X=ce("generated_code",""),be=ce("layout_pref","horizontal");var Aa=$('<span class="vertical-layout-icon">lll</span>'),Ia=$('<div class="header"><button class="api-btn" type="button"> </button> <h1>Conception AI ‚Äì Svelte Page Generator</h1> <div class="header-controls"><button type="button"><!></button></div></div>');function Sa(e,t){Z(t,!1);const a=()=>ne(be,"$layout",n),[n,i]=re();let r=N(t,"apiKey",8,""),c=N(t,"onApiModalOpen",8);function o(){be.update(p=>p==="horizontal"?"vertical":"horizontal")}Q();var u=Ia(),d=_(u),f=_(d,!0);b(d);var w=I(d,4),l=_(w),m=_(l);{var v=p=>{var E=ia("‚â°");x(p,E)},s=p=>{var E=Aa();x(p,E)};j(m,p=>{a()==="horizontal"?p(v):p(s,!1)})}b(l),b(w),b(u),L(()=>{Y(d,"aria-label",r()?"Change API Key":"Add API Key"),J(f,r()?"Change API Key":"Add API Key"),ge(l,1,`layout-btn ${a()??""}`,"svelte-1elxaub"),Y(l,"aria-label",a()==="horizontal"?"Switch to vertical layout":"Switch to horizontal layout")}),B("click",d,function(...p){c()?.apply(this,p)}),B("click",l,o),x(e,u),ee(),i()}var Ea=$('<p id="api-error" class="modal-error"> </p>'),ka=$('<div class="modal-backdrop"><div class="modal"><h2> </h2> <label class="sr-only">OpenAI API Key</label> <input type="password" placeholder="Enter your OpenAI API key (sk-...)" name="api_key" autocomplete="new-password"/> <!> <div class="modal-actions"><button type="button">Save</button> <button type="button">Cancel</button></div></div></div>');function Pa(e,t){Z(t,!1);let a=N(t,"show",8,!1),n=N(t,"apiKey",8,""),i=N(t,"error",8,""),r=N(t,"onSave",8),c=N(t,"onCancel",8),o=V("");const u="api-key-input-main";function d(){r()(A(o).trim())}function f(){C(o,""),c()()}ca(()=>(Ee(a()),Ee(n())),()=>{a()&&C(o,n())}),va(),Q();var w=$e(),l=ie(w);{var m=v=>{var s=ka(),p=_(s),E=_(p),k=_(E,!0);b(E);var h=I(E,2);Y(h,"for",u);var y=I(h,2);ua(y),Y(y,"id",u);var P=I(y,2);{var M=T=>{var R=Ea(),U=_(R,!0);b(R),L(()=>J(U,i())),x(T,R)};j(P,T=>{i()&&T(M)})}var D=I(P,2),K=_(D),O=I(K,2);b(D),b(p),b(s),L(()=>{J(k,n()?"Change API Key":"Add API Key"),Y(y,"aria-describedby",i()?"api-error":void 0)}),Oe(y,()=>A(o),T=>C(o,T)),B("click",K,d),B("click",O,f),x(v,s)};j(l,v=>{a()&&v(m)})}x(e,w),ee()}var xa=$('<div class="controls"><button type="button"> </button> <button type="button" aria-label="Undo last generation">Undo</button></div>');function Ca(e,t){Z(t,!1);const a=()=>ne(le,"$historyStack",n),[n,i]=re();let r=N(t,"loading",8,!1),c=N(t,"onGenerate",8),o=N(t,"onUndo",8);Q();var u=xa(),d=_(u),f=_(d,!0);b(d);var w=I(d,2);b(u),L(()=>{d.disabled=r(),Y(d,"aria-label",r()?"Generating code...":"Generate new code"),J(f,r()?"Generation...":"Generate new"),w.disabled=(a(),Ce(()=>a().length===0))}),B("click",d,function(...l){c()?.apply(this,l)}),B("click",w,function(...l){o()?.apply(this,l)}),x(e,u),ee(),i()}var $a=$(`<section class="panel"><h2>Prompt</h2> <label class="sr-only">Enter your prompt to generate Svelte code</label> <textarea name="user_prompt" placeholder="Describe or refine the page... (e.g., 'Add a red button') - Press Enter to generate" autocomplete="off" rows="4"></textarea> <div class="help-text"><small>Press Enter to generate ‚Ä¢ Shift+Enter for new line</small></div></section>`);function Ma(e,t){Z(t,!1);let a=N(t,"prompt",12,""),n=N(t,"loading",8,!1);const i="prompt-textarea-main",r=De();function c(f){(f.key==="Enter"&&(f.ctrlKey||f.metaKey)||f.key==="Enter"&&!f.shiftKey)&&(f.preventDefault(),!n()&&a().trim()&&r("submit"))}Q();var o=$a(),u=I(_(o),2);Y(u,"for",i);var d=I(u,2);da(d),Y(d,"id",i),se(2),b(o),L(()=>d.disabled=n()),Oe(d,a),B("keydown",d,c),x(e,o),ee()}var Oa=$(`
            <code> </code>
        `,1),Ka=$(`
            <code class="no-code">No code generated yet</code>
        `,1),Ta=$('<button type="button" aria-label="Download generated Svelte component" class="btn btn-primary">Download .svelte</button>'),Na=$(`<section class="panel"><h2>Generated Code</h2> <pre aria-live="polite" aria-atomic="true">
        <!>
    </pre> <!></section>`);function Da(e,t){const a=()=>ne(X,"$generatedCode",n),[n,i]=re();let r=N(t,"onDownload",8);var c=Na(),o=I(_(c),2),u=I(_(o));{var d=m=>{var v=Oa(),s=I(ie(v)),p=_(s,!0);b(s),se(),L(()=>J(p,a())),x(m,v)},f=m=>{var v=Ka();se(2),x(m,v)};j(u,m=>{a()?m(d):m(f,!1)})}se(),b(o);var w=I(o,2);{var l=m=>{var v=Ta();B("click",v,function(...s){r()?.apply(this,s)}),x(m,v)};j(w,m=>{a()&&m(l)})}b(c),x(e,c),i()}var Ra=$('<section class="panel"><h2>Preview</h2> <div class="preview-info"><p><small>Note: Accessibility warnings in the preview are normal and come from the AI-generated code.</small></p></div> <iframe id="preview-iframe" class="preview" sandbox="allow-scripts" referrerpolicy="no-referrer" title="Preview Generated Code" aria-label="Live preview of generated Svelte code" loading="lazy"></iframe></section>');function Ga(e){var t=Ra();x(e,t)}var za=$('<div class="empty-state svelte-1p3leh"><p class="svelte-1p3leh">No messages yet</p> <small class="svelte-1p3leh">Start a conversation to see history here</small></div>'),Ua=$('<div role="article"><strong> </strong> <span> </span></div>'),Ha=$('<section class="panel history-panel" aria-labelledby="conversation-heading"><h2 id="conversation-heading">üí¨ Conversation History</h2> <div role="log" aria-live="polite" class="conversation-list svelte-1p3leh"><!></div></section>');function La(e,t){Z(t,!1);const a=()=>ne(te,"$conversation",n),[n,i]=re();Q();var r=Ha(),c=I(_(r),2),o=_(c);{var u=f=>{var w=za();x(f,w)},d=f=>{var w=$e(),l=ie(w);ma(l,1,a,fa,(m,v)=>{var s=Ua(),p=_(s),E=_(p);b(p);var k=I(p,2),h=_(k,!0);b(k),b(s),L(()=>{ge(s,1,`message ${A(v).role??""}`,"svelte-1p3leh"),J(E,`${A(v).role==="user"?"üë§ You":"ü§ñ AI"}:`),J(h,A(v).content)}),x(m,s)}),x(f,w)};j(o,f=>{a().length===0?f(u):f(d,!1)})}b(c),b(r),x(e,r),ee(),i()}var Ya=$('<p class="text-error"> </p>'),Ba=$('<!> <!> <!> <!> <div><div class="panel prompt-panel"><!></div> <div class="panel code-panel"><!></div> <div class="panel preview-panel"><!></div> <div class="panel history-panel"><!></div></div>',1);function Qa(e,t){Z(t,!1);const a=()=>ne(be,"$layout",n),[n,i]=re();let r=V(""),c=V(""),o=V(""),u=V(!1),d=V(!1);Re(()=>{C(r,localStorage.getItem("openai_api_key")||"");const g=F(X);g&&s(g)});function f(){C(d,!0)}function w(g){g&&(C(r,g),localStorage.setItem("openai_api_key",A(r)),C(d,!1),C(o,""),alert("API Key saved."))}function l(){C(d,!1)}async function m(){if(!A(r)){C(o,"Please set your OpenAI API key first You can find your API key at https://platform.openai.com/account/api-keys."),f();return}if(A(c)){C(u,!0),C(o,"");try{const g=[...F(te),{role:"user",content:A(c)}],S=await wa(g);if(S.includes("Erreur"))throw new Error(S);le.update(G=>[...G,{code:F(X),chat:F(te)}]),X.set(S),te.update(G=>[...G,{role:"user",content:A(c)},{role:"assistant",content:S}]),s(S),C(c,"")}catch(g){C(o,g.message),A(o).includes("Incorrect API key provided")&&(C(o,"Erreur API: Incorrect API key provided You can find your API key at https://platform.openai.com/account/api-keys."),f())}finally{C(u,!1)}}}function v(){const g=F(le);if(g.length===0)return;const S=g[g.length-1];le.set(g.slice(0,-1)),X.set(S.code||""),te.set(S.chat||[]),s(S.code||"")}function s(g){try{const S=g.replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<\/?(html|head|body)[^>]*>/gi,""),G=S.match(/<style[^>]*>([\s\S]*?)<\/style>/i),q=S.match(/<script[^>]*>([\s\S]*?)<\/script>/i);let Ke=S.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"");const Te=`
        <html>
          <head>
            ${G?`<style>${G[1]}</style>`:""}
          </head>
          <body>
            ${Ke}
            ${q?`<script>${q[1]}<\/script>`:""}
          </body>
        </html>
      `,we=document.getElementById("preview-iframe");we&&(we.srcdoc=Te)}catch(S){C(o,`Render error: ${S.message}`)}}function p(){const g=F(X);if(!g)return;const S=new Blob([g],{type:"text/plain"}),G=URL.createObjectURL(S),q=document.createElement("a");q.href=G,q.download="GeneratedPage.svelte",q.click(),URL.revokeObjectURL(G)}Q();var E=Ba(),k=ie(E);Sa(k,{get apiKey(){return A(r)},onApiModalOpen:f});var h=I(k,2);Pa(h,{get show(){return A(d)},get apiKey(){return A(r)},get error(){return A(o)},onSave:w,onCancel:l});var y=I(h,2);Ca(y,{get loading(){return A(u)},onGenerate:m,onUndo:v});var P=I(y,2);{var M=g=>{var S=Ya(),G=_(S,!0);b(S),L(()=>J(G,A(o))),x(g,S)};j(P,g=>{A(o)&&g(M)})}var D=I(P,2),K=_(D),O=_(K);Ma(O,{get loading(){return A(u)},get prompt(){return A(c)},set prompt(g){C(c,g)},$$events:{submit:m},$$legacy:!0}),b(K);var T=I(K,2),R=_(T);Da(R,{onDownload:p}),b(T);var U=I(T,2),ve=_(U);Ga(ve),b(U);var oe=I(U,2),de=_(oe);La(de,{}),b(oe),b(D),L(()=>ge(D,1,`container ${a()??""}`)),x(e,E),ee(),i()}export{Qa as component,Xa as universal};
